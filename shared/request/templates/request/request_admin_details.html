{% extends "base_internal.html" %}
{% block content %}
{% load static %} 
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Requests</title>

<link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/requests/styles.css' %}" rel="stylesheet">
</head>
<body>
<div class="main-container"> 
    <div class="container-a">
        <div class="project-text">Detailed View </div>  
        <div style="display:flex;flex-direction:row;justify-content:space-between;align-items:center;">
            {% if req.status == 'UNDER_REVIEW' %}
            <div style="display: flex; gap: 15px;">
                <button type="button" class="action-btn approve-btn" id="approve-btn">Approve</button>
                <button type="button" class="action-btn reject-btn" id="reject-btn">Reject</button>
            </div>
            {% elif req.status == 'APPROVED' %}
            <div style="display: flex; gap: 40px;">
                <button type="button" class="action-btn endorse-btn" id="endorse-btn">Endorse</button>
            </div>
            {% endif %}
        </div> 
    </div>
    
    <div class="detail-container"> 
        <div class="label"> 
            <h2>Overview</h2>
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The user who submitted this request.</span>
                </span>
                <span class="detail-item">Request Submmited by</span>
                <span class="detail-value">{{ request.user.get_full_name }}</span>
            </div>
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The proposed title of the project.</span>
                </span>
                <span class="detail-item">Title</span>
                <span class="detail-value">{{ req.title }}</span>
            </div>
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The external organization making the request.</span>
                </span>
                <span class="detail-item">Organization</span>
                <span class="detail-value">{{ req.organization }}</span>
            </div> 
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">A brief overview of the request's objective and scope.</span>
                </span>
                <span class="detail-item">Summary</span>
                <div class="detail-value sum">{{ req.summary }}</div>
            </div> 
        </div> 
        
        <div class="label"> 
            <h2>Details</h2>
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The main geographic area where the project will be implemented.</span>
                </span>
                <span class="detail-item">Primary Location</span>
                <span class="detail-value">{{ req.primary_location }}</span>
            </div>
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The community or group that the project is intended to serve.</span>
                </span>
                <span class="detail-item">Primary Beneficiaries</span>
                <span class="detail-value">{{ req.primary_beneficiary }}</span>
            </div> 
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The date and time the request was officially submitted.</span>
                </span>
                <span class="detail-item">Date Submitted</span>
                <span class="detail-value">{{ req.submitted_at|date:'Y-m-d H:i' }}</span>
            </div> 
        </div> 
        
        <div class="label"> 
            <h2>Other</h2>
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The current processing status of this request.</span>
                </span>
                <span class="detail-item">Status</span>
                <span class="detail-value">{{ req.get_status_display }}</span>
            </div>
        
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The attached Letter of Intent document.</span>
                </span>
                <span class="detail-item">Letter of Intent</span>
                <span class="detail-value">
                    {% if req.letter_of_intent %}
                        <a href="{{ req.letter_of_intent.url }}" target="_blank">{{ req.letter_of_intent.name }}</a>
                    {% else %}
                        <span style="color:#888;">None</span>
                    {% endif %}
                </span>
            </div>
            {% if req.reason %}
            <div class="detail-trio">
                <span class="detail-icon">
                    <svg width="24" height="24"><use href="#detail-icon"/></svg>
                    <span class="detail-tooltip">The specific reason provided for rejecting the request.</span>
                </span>
                <span class="detail-item">Reason of Rejection</span>
                <div class="detail-value sum">{{ req.reason|default:'-' }}</div>
            </div>
            {% endif %}
        </div> 
    </div>
 
    <a href="{% url 'request_dispatcher' %}" class="back-btn" style="width:auto;align-self:left;"> 
        <svg width="18" height="19" viewBox="0 0 18 19" fill="none" xmlns="http://www.w3.org/2000/svg">
            <use xlink:href="#icon-arrow-left" />
        </svg>
        <span class="back-btn-text">Back</span>
    </a>

    <!-- Modals -->
    <div id="modal-bg" class="modal-bg" style="display:none;">
        <div class="modal" id="modal-reject" style="display:none;">
            <div class="modal-title">Reject Request</div>
            <div class="modal-content">Please provide a reason for rejection:</div>
            <form method="post" action="{% url 'admin_request_action' req.id %}" style="width:100%;">
                {% csrf_token %}
                <input type="hidden" name="action" value="reject" class="user-details-value"/>
                <textarea name="reason" rows="3" maxlength="500" required placeholder="Enter reason..." style="resize:vertical; height: 20rem; width: 30rem;"></textarea>
                <div class="modal-actions">
                    <button type="button" class="action-btn cancel-btn" id="cancel-reject">Cancel</button>
                    <button type="submit" class="action-btn reject-btn">Reject</button>
                </div>
            </form>
        </div>
        <div class="modal" id="modal-approve" style="display:none;">
            <div class="modal-title">Confirm Approval</div>
            <div class="modal-content">Are you sure you want to approve this request?</div>
            <form method="post" action="{% url 'admin_request_action' req.id %}">
                {% csrf_token %}
                <input type="hidden" name="action" value="approve" />
                <div class="modal-actions">
                    <button type="button" class="action-btn cancel-btn" id="cancel-approve">Cancel</button>
                    <button type="submit" class="action-btn approve-btn">Approve</button>
                </div>
            </form>
        </div>
        <div class="modal" id="modal-endorse" style="display:none;">
            <div class="modal-title">Confirm Endorsement</div>
            <div class="modal-content">Confirm that this request letter has been endorsed<br>and forwarded to the president's office?</div>
            <form method="post" action="{% url 'admin_request_action' req.id %}">
                {% csrf_token %}
                <input type="hidden" name="action" value="endorse" />
                <div class="modal-actions">
                    <button type="button" class="action-btn cancel-btn" id="cancel-endorse">Cancel</button>
                    <button type="submit" class="action-btn endorse-btn">Endorse</button>
                </div>
            </form>
        </div>
        <div class="modal" id="modal-deny" style="display:none;">
            <div class="modal-title">Deny Request</div>
            <div class="modal-content">Please provide a reason for denial:</div>
            <form method="post" action="{% url 'admin_request_action' req.id %}" style="width:100%;">
                {% csrf_token %}
                <input type="hidden" name="action" value="deny" />
                <textarea name="reason" rows="3" required placeholder="Enter reason..." style="resize:vertical;"></textarea>
                <div class="modal-actions">
                    <button type="button" class="back-btn" id="cancel-deny">Cancel</button>
                    <button type="submit" class="reject-btn">Deny</button>
                </div>
            </form>
        </div>
    </div>

    <script>
    // Modal logic
    function showModal(which) {
        document.getElementById('modal-bg').style.display = 'flex';
        document.getElementById('modal-reject').style.display = (which === 'reject') ? 'flex' : 'none';
        document.getElementById('modal-approve').style.display = (which === 'approve') ? 'flex' : 'none';
        document.getElementById('modal-endorse').style.display = (which === 'endorse') ? 'flex' : 'none';
        document.getElementById('modal-deny').style.display = (which === 'deny') ? 'flex' : 'none';
    }
    function hideModal() {
        document.getElementById('modal-bg').style.display = 'none';
        document.getElementById('modal-reject').style.display = 'none';
        document.getElementById('modal-approve').style.display = 'none';
        document.getElementById('modal-endorse').style.display = 'none';
        document.getElementById('modal-deny').style.display = 'none';
    }
    document.addEventListener('DOMContentLoaded', function() {
        var rejectBtn = document.getElementById('reject-btn');
        var approveBtn = document.getElementById('approve-btn');
        var endorseBtn = document.getElementById('endorse-btn');
        var denyBtn = document.getElementById('deny-btn');
        if (rejectBtn) rejectBtn.onclick = function() { showModal('reject'); };
        if (approveBtn) approveBtn.onclick = function() { showModal('approve'); };
        if (endorseBtn) endorseBtn.onclick = function() { showModal('endorse'); };
        if (denyBtn) denyBtn.onclick = function() { showModal('deny'); };
        // Cancel buttons
        var cancelReject = document.getElementById('cancel-reject');
        var cancelApprove = document.getElementById('cancel-approve');
        var cancelEndorse = document.getElementById('cancel-endorse');
        var cancelDeny = document.getElementById('cancel-deny');
        if (cancelReject) cancelReject.onclick = hideModal;
        if (cancelApprove) cancelApprove.onclick = hideModal;
        if (cancelEndorse) cancelEndorse.onclick = hideModal;
        if (cancelDeny) cancelDeny.onclick = hideModal;
        // Hide modal when clicking outside
        document.getElementById('modal-bg').addEventListener('click', function(e) {
            if (e.target === this) hideModal();
        });
    });
    </script>

</body>
</html>
{% endblock %}
