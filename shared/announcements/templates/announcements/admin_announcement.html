{% extends "base_internal.html" %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Announcements</title>

<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/projects/a_module_styles.css' %}" rel="stylesheet">
</head>
<body>
	<!-- Main Container -->
	<div class="main-container">

		<!-- Search Bar -->
		<div class="search-container">
		       <form class="search-bar" method="get" action="">
					<svg width="16" height="16" style="margin-right:10px;"> <use href="#icon-search"></use> </svg>
					<input type="text" name="search" placeholder="Search by title value="{{ search|default:'' }}"/>
					<button type="button" id="filterBtn" style="background:none;border:none;padding:0;margin-right:5px;cursor:pointer;">
						<svg width="16" height="16"> <use href="#icon-filter"></use> </svg>
					</button>
					<div id="filterDropdown" class="filter-dropdown">
						<div class="filter-grid">
							
							<!-- Top Left - Sort By -->
							<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
								Sort By
								<select name="sort" style="width:100%;margin-top:6px;">
									<option value="date" {% if sort_by == 'date' %}selected{% endif %}>Date</option>
									<option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title</option>
									<option value="status" {% if sort_by == 'status' %}selected{% endif %}>Status</option>
									<option value="edited" {% if sort_by == 'edited' %}selected{% endif %}>Edited</option>
								</select>
							</label>

							<!-- Top Middle - Order -->
							<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
								Order
								<select name="order" style="width:100%;margin-top:6px;">
									<option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>Descending</option>
									<option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>Ascending</option>
								</select>
							</label>

							<!-- Top Right - Status -->
							<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
								Status
								<select name="status" style="width:100%;margin-top:6px;">
									<option value="">All Status</option>
									<option value="published" {% if filter_status == 'published' %}selected{% endif %}>Published</option>
									<option value="scheduled" {% if filter_status == 'scheduled' %}selected{% endif %}>Scheduled</option>
									<option value="archived" {% if filter_status == 'archived' %}selected{% endif %}>Archived</option>
									<option value="unarchived" {% if filter_status == 'unarchived' %}selected{% endif %}>Unarchived</option>
								</select>
							</label>

							<!-- Bottom Left - Author -->
							<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
								Author
								<select name="author" style="width:100%;margin-top:6px;">
									<option value="">All Authors</option>
									{% for author in authors %}
									<option value="{{ author.id }}" {% if filter_author == author.id|stringformat:'s' %}selected{% endif %}>{{ author.get_full_name|default:author.username }}</option>
									{% endfor %}
								</select>
							</label>

							<!-- Bottom Middle - Edited -->
							<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
								Edited
								<select name="edited" style="width:100%;margin-top:6px;">
									<option value="">All</option>
									<option value="true" {% if filter_edited == 'true' %}selected{% endif %}>Edited</option>
									<option value="false" {% if filter_edited == 'false' %}selected{% endif %}>Not Edited</option>
								</select>
							</label>

							<!-- Bottom Right - Date -->
							<!-- Date From -->
							<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
								Date From
								<input type="date" name="date_from" value="{{ date_from|default:'' }}" style="width:87%;margin-top:6px;" />
							</label>

							<!-- Date To -->
							<label style="font-weight:500;color:#374151;display:flex;flex-direction:column;">
								Date To
								<input type="date" name="date_to" value="{{ date_to|default:'' }}" style="width:87%;margin-top:6px;" />
							</label>
						</div>

						<!-- Buttons Row -->
						<div style="display:flex;justify-content:flex-end;gap:10px;margin-top:24px;">
						<button type="submit" class="filter-apply">Apply</button>
						<button type="button" id="closeFilter" class="filter-close">Close</button>
						</div>
					</div>

		       </form>
		</div> 
		 
		<div class="announcement-header">
			<h1 class="project-text">Announcements</h1>
			<!-- Restriction for User Roles Here -->
			<a href="{% url 'announcement_add' %}" class="add-user-btn">  
				<i class="fa-solid fa-bullhorn"></i>
				Add Announcement 
			</a>
		</div>

		<!-- Announcements Grid -->
		<div class="announce-grid">
			{% for announcement in announcements %}
				{% if announcement.archived %}
				<div class="announce-card" style="cursor:pointer;" onclick="cardClick(event, '{{ announcement.id }}')">
					<span style="position:absolute;top:12px;left:12px;background:#F4A261;color:white;padding:4px 12px;border-radius:12px;font-size:0.95rem;font-weight:500;z-index:3;box-shadow:0 2px 8px rgba(220,38,38,0.12);">Archived</span>
				{% else %}
				<div class="announce-card" style="cursor:pointer;" onclick="cardClick(event, '{{ announcement.id }}')">
				{% endif %}
					<div class="announce-options" >
						<button class="options-toggle" onclick="toggleOptions('{{ announcement.id }}')" title="More options">
							<svg viewBox="0 0 24 24" fill="currentColor">
								<circle cx="12" cy="5" r="2"></circle>
								<circle cx="12" cy="12" r="2"></circle>
								<circle cx="12" cy="19" r="2"></circle>
							</svg>
						</button>
						<div class="options-dropdown" id="options-{{ announcement.id }}">
							<a class="options-item edit-option" href="{% url 'announcement_edit' announcement.id %}" style="text-decoration: none;">
								<svg width="16" height="16"><use href="#edit-icon"></use></svg>Edit
							</a>
							<a href="#" class="options-item delete-option delete-modal-link" data-delete-url="{% url 'announcement_delete' announcement.id %}" data-announcement-title="{{ announcement.title }}" style="color:#DC2626;text-decoration:none;">
								<svg width="16" height="16"><use href="#delete-icon"></use></svg>Delete
							</a>
							{% if not announcement.archived %}
							<a class="options-item" href="{% url 'announcement_archive' announcement.id %}" style="color:#F4A261;text-decoration:none;">
								<svg width="16" height="16"><use href="#archive-icon"></use></svg>Archive
							</a>
							{% else %}
							<a class="options-item" href="{% url 'announcement_unarchive' announcement.id %}" style="color:#F4A261;text-decoration:none;">
								<svg width="16" height="16"><use href="#archive-icon"></use></svg>Unarchive
							</a>
							{% endif %}
						</div>
					</div>
					<div class="announce-thumb">
						{% if announcement.cover_photo %}
							<img src="{{ announcement.cover_photo.url }}" alt="Cover Photo" style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
						{% else %}
							<img src="{% static 'announce.png' %}" alt="Default Announcement" style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
						{% endif %}
					</div>
					<div class="announce-text-container">
						<div class="announce-meta">
							{% if announcement.edited_at and announcement.published_at %}
								<span class="announce-date">Last Edited: {{ announcement.edited_at|date:"F d, Y" }} at {{ announcement.edited_at|time:"H:i" }}</span>
							{% elif not announcement.edited_at and announcement.published_at %}
								<span class="announce-date">Published: {{ announcement.published_at|date:"F d, Y" }} at {{ announcement.published_at|time:"H:i" }}</span>
							{% elif announcement.edited_at and announcement.scheduled_at %}
								<span class="announce-date">Scheduled (Edited): {{ announcement.scheduled_at|date:"F d, Y" }} at {{ announcement.scheduled_at|time:"H:i" }}</span>
							{% elif not announcement.published_at and announcement.scheduled_at %}
								<span class="announce-date">Scheduled: {{ announcement.scheduled_at|date:"F d, Y" }} at {{ announcement.scheduled_at|time:"H:i" }}</span>
							{% endif %}
						</div>
						<h3>{{ announcement.title }}</h3>
						{% if announcement.body|length > 75 %}
							<p>{{ announcement.body|slice:":75" }}&hellip;</p>
						{% else %}
							<p>{{ announcement.body }}</p>
						{% endif %}
						<p class="announce-author">by: {{ announcement.published_by.get_full_name|default:announcement.published_by.username }}</p>
					</div>
				</div>
			{% empty %}	
				<p></p>
				<p style="text-align:center">No announcements found.</p>
				<p></p>
			{% endfor %}
		</div>

		<!-- Pagination -->
		<div class="pagination-container">
			{% if page_obj.has_previous %}
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">First</a>
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
			{% else %}
				<button class="pagination-button" disabled>First</button>
				<button class="pagination-button" disabled>Previous</button>
			{% endif %}

			{% for num in page_range %}
				{% if num == page_obj.number %}
					<button class="pagination-button active" disabled>{{ num }}</button>
				{% else %}
					<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
				{% endif %}
			{% endfor %}

			{% if page_obj.has_next %}
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
				<a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ paginator.num_pages }}">Last</a>
			{% else %}
				<button class="pagination-button" disabled>Next</button>
				<button class="pagination-button" disabled>Last</button>
			{% endif %}
		</div>
	</div>

<!-- SVG Sprite Section -->
<svg>

	<!-- Search -->
	<symbol id="icon-search" viewBox="0 0 21 21" fill="none">
		<path d="M8.89152 15.9057C9.75056 15.9057 10.6012 15.7365 11.3948 15.4077C12.1885 15.079 12.9096 14.5972 13.5171 13.9897C14.1245 13.3823 14.6064 12.6612 14.9351 11.8675C15.2638 11.0739 15.433 10.2232 15.433 9.36417C15.433 8.50513 15.2638 7.6545 14.9351 6.86084C14.6064 6.06719 14.1245 5.34606 13.5171 4.73862C12.9096 4.13119 12.1885 3.64934 11.3948 3.3206C10.6012 2.99186 9.75056 2.82266 8.89152 2.82266C7.1566 2.82266 5.49274 3.51185 4.26597 4.73862C3.03919 5.9654 2.35 7.62926 2.35 9.36417C2.35 11.0991 3.03919 12.763 4.26597 13.9897C5.49274 15.2165 7.1566 15.9057 8.89152 15.9057V15.9057ZM15.7819 14.713L19.685 18.6161C19.7891 18.7167 19.872 18.8371 19.9291 18.9701C19.9861 19.1032 20.0161 19.2463 20.0173 19.391C20.0184 19.5358 19.9907 19.6793 19.9358 19.8133C19.8809 19.9472 19.7999 20.0689 19.6974 20.1712C19.595 20.2735 19.4732 20.3544 19.3392 20.4091C19.2052 20.4638 19.0616 20.4913 18.9168 20.4899C18.772 20.4886 18.629 20.4584 18.496 20.4012C18.3631 20.3439 18.2428 20.2608 18.1423 20.1566L14.2392 16.2535C12.4866 17.614 10.2814 18.2554 8.07247 18.0472C5.86357 17.839 3.81705 16.7968 2.34951 15.1328C0.881971 13.4688 0.103735 11.308 0.173229 9.09044C0.242723 6.87284 1.15472 4.76508 2.72357 3.19623C4.29242 1.62738 6.40018 0.715379 8.61778 0.645885C10.8354 0.576391 12.9961 1.35463 14.6601 2.82217C16.3241 4.28971 17.3663 6.33623 17.5745 8.54513C17.7827 10.754 17.1413 12.9592 15.7808 14.7119L15.7819 14.713Z" fill="#5A5252"/>
	</symbol>

	<!-- Filter -->
	<symbol id="icon-filter" viewBox="0 0 23 22" fill="none">
		<path opacity="0.9" d="M21.5399 1.92871H1.37988L9.44388 11.4644V18.0567L13.4759 20.0727V11.4644L21.5399 1.92871Z" stroke="#1E1E1E" stroke-width="2.016" stroke-linecap="round" stroke-linejoin="round"/>
	</symbol>

	<!-- Edit -->
	<symbol id="edit-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
		<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
		<path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
	</symbol>

	<!-- Delete -->
    <symbol id="delete-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <polyline points="3,6 5,6 21,6"></polyline>
        <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
    </symbol>

    <!-- Archive/Unarchive -->
    <symbol id="archive-icon" viewBox="0 0 20 18" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M0 2C0 1.46957 0.210714 0.960859 0.585786 0.585786C0.960859 0.210714 1.46957 0 2 0H18C18.5304 0 19.0391 0.210714 19.4142 0.585786C19.7893 0.960859 20 1.46957 20 2C20 2.53043 19.7893 3.03914 19.4142 3.41421C19.0391 3.78929 18.5304 4 18 4H2C1.46957 4 0.960859 3.78929 0.585786 3.41421C0.210714 3.03914 0 2.53043 0 2ZM17 6C17.513 6 17.936 6.463 17.993 7.06L18 7.2V14.4C18 16.317 16.751 17.884 15.176 17.994L15 18H5C3.402 18 2.096 16.501 2.005 14.612L2 14.4V7.2C2 6.537 2.448 6 3 6H17ZM12 8H8L7.883 8.007C7.63995 8.03591 7.41594 8.15296 7.25341 8.33597C7.09088 8.51897 7.00111 8.75524 7.00111 9C7.00111 9.24476 7.09088 9.48103 7.25341 9.66403C7.41594 9.84704 7.63995 9.96409 7.883 9.993L8 10H12L12.117 9.993C12.36 9.96409 C12.5841,9 .84704,12.7466 9.66403C12.9091 9.48103 12.9989 9.24476 12.9989 9C12.9989 8.75524 12.9091 8.51897 12.7466 8.33597C12.5841 8.15296 12.36 8.03591 12.117 8.007L12 8Z" fill="#F4A261"/>
    </symbol>

</svg>


<!-- Delete Confirmation Modal -->
<div id="deleteAnnouncementModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.18);z-index:9999;align-items:center;justify-content:center;">
	<div style="background:white;padding:2rem 2.5rem;border-radius:16px;box-shadow:0 4px 32px rgba(0,0,0,0.18);max-width:350px;margin:auto;display:flex;flex-direction:column;align-items:center;">
		<div style="font-size:1.25rem;font-weight:600;color:#E53E3E;margin-bottom:1rem;">Confirm Deletion</div>
		<div id="deleteAnnouncementModalMsg" style="font-size:1rem;color:#444;margin-bottom:2rem;text-align:center;"></div>
		<div style="display:flex;gap:1rem;">
			<button id="cancelDeleteAnnouncementBtn" style="background:#e5e7eb;color:#374151;padding:0.75rem 1.5rem;border-radius:8px;font-size:1rem;font-weight:500;border:none;cursor:pointer;">Cancel</button>
			<button id="confirmDeleteAnnouncementBtn" style="background:#E53E3E;color:white;padding:0.75rem 1.5rem;border-radius:8px;font-size:1rem;font-weight:500;border:none;cursor:pointer;">Delete</button>
		</div>
	</div>
</div>

<script>
	// Announcement Delete confirmation modal logic
	let announcementDeleteUrl = '';
	document.querySelectorAll('.delete-modal-link').forEach(function(link) {
		link.addEventListener('click', function(e) {
			e.preventDefault();
			announcementDeleteUrl = link.getAttribute('data-delete-url');
			var announcementTitle = link.getAttribute('data-announcement-title');
			document.getElementById('deleteAnnouncementModalMsg').innerHTML = 'Are you sure you want to delete the announcement <strong>' + announcementTitle + '</strong>? This action cannot be undone.';
			document.getElementById('deleteAnnouncementModal').style.display = 'flex';
		});
	});
	document.getElementById('cancelDeleteAnnouncementBtn').onclick = function() {
		document.getElementById('deleteAnnouncementModal').style.display = 'none';
		announcementDeleteUrl = '';
	};
	document.getElementById('confirmDeleteAnnouncementBtn').onclick = function() {
		if (announcementDeleteUrl) {
			window.location.href = announcementDeleteUrl;
		}
	};
	// Hide modal when clicking outside
	document.getElementById('deleteAnnouncementModal').addEventListener('mousedown', function(e) {
		if (e.target === this) {
			this.style.display = 'none';
			announcementDeleteUrl = '';
		}
	});
       // Card click handler that ignores clicks on options
       function cardClick(event, id) {
	       if (event.target.closest('.announce-options')) {
		       return;
	       }
	       window.location.href = 'details/' + id + '/';
       }

       // Options menu functionality
       let activeDropdown = null;
       function toggleOptions(id) {
	       const dropdown = document.getElementById(`options-${id}`);
	       if (!dropdown) return;
	       if (activeDropdown && activeDropdown !== dropdown) {
		       activeDropdown.classList.remove('show');
	       }
	       dropdown.classList.toggle('show');
	       activeDropdown = dropdown.classList.contains('show') ? dropdown : null;
       }
       document.addEventListener('click', function(event) {
	       if (!event.target.closest('.announce-options')) {
		       if (activeDropdown) {
			       activeDropdown.classList.remove('show');
			       activeDropdown = null;
		       }
	       }
       });

       // Filter dropdown logic
       const filterBtn = document.getElementById('filterBtn');
       const filterDropdown = document.getElementById('filterDropdown');
       const closeFilter = document.getElementById('closeFilter');
       if (filterBtn && filterDropdown) {
	       filterBtn.addEventListener('click', function(e) {
		       e.preventDefault();
		       filterDropdown.style.display = 'block';
	       });
       }
       if (closeFilter && filterDropdown) {
	       closeFilter.addEventListener('click', function(e) {
		       e.preventDefault();
		       filterDropdown.style.display = 'none';
	       });
       }
       // Hide dropdown when clicking outside
       document.addEventListener('mousedown', function(e) {
	       if (filterDropdown && !filterDropdown.contains(e.target) && e.target !== filterBtn) {
		       filterDropdown.style.display = 'none';
	       }
       });
</script>

</body>
</html>

{% endblock %}