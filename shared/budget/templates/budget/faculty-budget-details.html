{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ project.title }} - Project Budget</title> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">  
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0rem;
            padding: 0rem;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-family: Helvetica, Arial, sans-serif;
            background-color: #e9e9e9;
        }
        main {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: stretch;
            gap: 1rem;
        }
        header {
            background-color: #245F3E;
            position: relative;
            top: 0;
            width: 100%;
            padding: 0rem; 
            height: 4rem;
        }
        footer {
            background-color: #245F3E;
            position: relative;
            bottom: 0;
            width: 100%;
            height: 20rem;
        } 
        main > section { 
            padding: 3rem 8rem 0 8rem;
            background-color: whitesmoke;
            box-shadow: 0 6px 0.5rem rgba(0, 0, 0, 0.2); 
        } 
        .tags {
            display: flex; 
            justify-content: space-between; 
            width: 100%; 
            margin-bottom: 2.25rem;
        }
        .dropdown {
            position: relative;
            width: 9.5rem;
        }
        .dropdown-btn { 
            margin: 0.75rem; 
            border: none;
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.75rem;
            background: none;
            text-align: center;
            cursor: pointer;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 400;
            font-size: 1rem; 
            border: 0.08rem solid whitesmoke;
        } 
        .dropdown-btn:hover {
            border: 0.08rem solid #000000;
        }
        .dropdown-menu {
            position: absolute;
            top: calc(100%);
            left: 0;
            margin: 0;
            right: 0; 
            width: 100%;
            background: white;
            border: 0.08rem solid #ccc;
            border-radius: 0.75rem; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 10;
            overflow: hidden;
        }
        .dropdown-item {
            padding: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 400;
            text-align: center;
            border-bottom: 1px solid rgb(196, 196, 196);
        }
        .dropdown-item:hover {
            background-color: #000000;
            color: white;
        }
        .hidden {
            display: none !important;
        } 
        .sort-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #333;
            margin-left: 0.5rem;
        }  
        .project-card {
            display: grid;
            grid-template-rows: 1fr 1fr;
            gap: 0rem;
            margin: -0.5rem -2.5rem;
        }
        .project-card > div {
            border-bottom: 1px rgb(122, 122, 122) solid;
            padding: 1rem 3rem;
            margin-bottom: 0rem;
        }
        h5 {
            font-size: 0.9rem;
            color: #666;
            margin: 1rem 0 2rem 0; 
            font-weight: 300; 
        }
        .title {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 0.25rem 0 1rem 0;
            color: #222; 
            text-decoration: none;
        } 
        .title:hover {
            color: #007bff; 
            text-decoration: none;
        }
        .project-authors {
            display: flex; 
            flex-direction: row; 
            align-items: center;
            gap: 1.5rem;
            margin: 1rem 0 2rem 0; 
            position: relative;
        } 
        .project-authors content {
            display: flex; 
            flex-direction: row; 
            align-items: center; 
            gap: 0.75rem;
        }
        .project-authors img {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            object-fit: cover; 
            border: 0.08rem solid #ccc;
        } 
        .project-authors a { 
            font-size: 0.9rem;
            color: #000000;
            text-decoration: none;
        } 
        .project-authors a:hover { 
            color: #007bff;
        }
        .view {
            display: inline-block;
            margin-top: 0.75rem;
            font-size: 0.9rem;
            color: #007bff;
            text-decoration: none;
        }
        .view:hover {
            text-decoration: underline;
        } 
        .project-tags {
            margin: 1rem 0;
        } 
        .campus {
            background-color: #ff9f10; 
            color: rgb(55, 39, 0);
            border: 0.08rem solid #ff9f10;
            font-weight: 600; 
            padding: 0.35rem 0.6rem;
            margin-right: 0.5rem;
            cursor: pointer;
        } 
        .agenda {
            background: linear-gradient(90deg, white, #00ff6e3d); 
            color: #313131;
            border: 0.08rem solid #313131;
            font-weight: 500; 
            padding: 0.35rem 0.6rem;
            margin-right: 0.5rem;
            cursor: pointer;
        } 
        .status {
            background-color: whitesmoke; 
            color: #1CB889;
            border: 0.08rem solid #1CB889;
            font-weight: 500; 
            padding: 0.35rem 0.6rem;
            margin-right: 0.5rem;
            cursor: pointer;
        }   
        .tab-contents-section {
            padding: 0 8rem 3rem 8rem;
            background-color: #e9e9e9;
            margin-bottom: 0; 
            box-shadow: 0 0 0 rgba(0, 0, 0, 0.2);
        }
        .tabs { 
            margin-top: 1rem;
            display: flex; 
        }
        .tabs button {
            background: none;
            border: none;
            width: 9rem; 
            height: 5rem;
            font-size: 1rem;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
        }
        .tabs button:hover {
            border-bottom: 4px solid #245F3E;
        }
        .tabs button.active {
            border-bottom: 4px solid #245F3E;
        } 
        .tab-content {
            display: none;
            margin-top: 2rem;
        }
        .tab-content.active {
            display: block;
        }
        .dropdown2 {
            position: relative;
            width: 9.5rem;
        }
        .dropdown-btn2 { 
            margin: 0.75rem; 
            border: none;
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.75rem;
            background: none;
            text-align: center;
            cursor: pointer;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 400;
            font-size: 1rem; 
            border: 0.08rem solid #e9e9e9;
        } 
        .dropdown-btn2:hover {
            border: 0.08rem solid #000000;
        }
        .dropdown-menu2 {
            position: absolute;
            top: calc(100% - 0.7rem);
            left: 0.8rem;
            margin: 0;
            right: 0; 
            width: 100%;
            background: white;
            border: 0.08rem solid #ccc;
            border-radius: 0.75rem; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 10;
            overflow: hidden;
        }
        .dropdown-item2 {
            padding: 0.75rem;
            cursor: pointer;
            transition: background 0.2s;
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 400;
            text-align: center;
            border-bottom: 1px solid rgb(196, 196, 196);
        }
        .dropdown-item2:hover {
            background-color: #000000;
            color: white;
        } 
        .sort-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #333;
            margin-left: 0.5rem;
        }  
        .expand-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.3rem; 
            color: #090909;
            transition: color 0.2s;
            z-index: 100;
        }
        .expand-btn:hover {
            color: #37d4ff;
        }
        .expand-rev {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.3rem; 
            color: #090909;
            transition: color 0.2s;
            z-index: 100;
        }
        .expand-rev:hover {
            color: #37d4ff;
        } 
        .project-content {
            display: flex;
            flex-direction: row;
            gap: 1rem;    
            align-items: flex-start; 
        }
        .project-content section {
            width: 35rem;
            border-radius: 0.5rem;
            flex: 1; 
        }
        .logs {
            background-color: whitesmoke;
            border-radius: 2rem; 
            box-shadow: 0 6px 0.5rem rgba(0, 0, 0, 0.2); 
            max-height: 25rem;
             overflow-y: auto; 
             overflow-x: hidden;
            position: relative;
        }
        table th, table td {
            padding: 0.5rem;
            font-size: 1rem;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            table-layout: fixed;
            overflow-x: hidden;
        }
        table th {
            background-color: #e1e1e1;
            color: rgb(7, 7, 7);
            text-align: left;
            padding: 1rem;
            border-bottom: 0.08rem solid #a1a1a1;
        }
        table td {
            padding: 1rem;
            border-bottom: 0.08rem solid #a1a1a1;
        }
        .project-summary {
            position: relative;
            width: 30rem;
            height: 40rem;
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
        }
        .chart-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            max-height: 100%;
        }
        .chart-container {
            width: 16rem;
            height: 16rem;
            flex-shrink: 0;
            position: relative;
        }
        .goal-title {
            text-align: left;
            margin-top: 0.5rem;
            font-size: 1.25rem;
            width: 75%;
            word-wrap: break-word;
        }
        .project-summary canvas {
            width: 14rem !important;
            height: 14rem !important;
            flex-shrink: 0; 
        } 
        .cash-available {
            font-size: 2rem;
        }
        .cash-available p { 
            margin: 0.2rem 0 0 0;
        }
        .tablenpag { 
            margin: 0; 
            border: 0.08rem solid #a1a1a1;
        } 
        .expense-add { 
            position: absolute; 
            right: 0;
        }  
        .expense-add button { 
            color: white; 
            background-color: #245F3E; 
            padding: 0.5rem 1rem; 
            font-size: 1rem; 
            border-radius: 2rem;
        } 
        .expense-add button:hover {
            background-color: #000;
            transition: 1s;
        }
        .files-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1rem 0;
        }
        .files-header h3 {
            margin: 0;
            font-size: 1.2rem; 
            font-weight: 500;
        }
        .file-list {
            margin-top: -1rem;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
        }
        .file-card {
            padding: 0.75rem;
        }
        .file-card img {
            max-height: 10rem;
            border: 1px solid #000000;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .file-card h4 {
            font-size: 1rem;
            margin: 0.3rem 0;
            font-weight: 500;
        }
        .file-card p {
            font-size: 0.75rem;
            margin-top: 0.5rem;
            color: #555;
        } 
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            pointer-events: auto; 
            opacity: 0;
            transition: opacity 0.2s;
        }
        .overlay:not(.hidden) {
            pointer-events: auto;
            opacity: 1;
        }
        .overlay-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 45rem;
            max-width: 90%;
            position: relative; 
            z-index: 201; 
        }
        .close-x {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            transition: color 0.2s ease;
        }
        .close-x:hover {
            color: #000;
        }
        .expenseForm h2 {
            font-weight: 400;
        }
        .expenseForm label {
            font-family: Helvetica, Arial, sans-serif;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        .expenseForm div {
            padding: 0.5rem;
        }
        .expenseForm #notes, #amount, #reason {
            padding: 1rem 0.5rem;
            border: 1px solid #868686ff;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            width: 95%;
            background-color: #e9e9e9;
        }
        #submitexpense {
            color: white; 
            background-color: #245F3E; 
            padding: 0.5rem 1rem; 
            font-size: 1rem; 
            border-radius: 2rem;
        }
        #submitexpense:hover {
            background-color: #000;
            transition: 1s;
        }
        #closeOverlay {
            color: white; 
            background-color: #5f2424ff; 
            padding: 0.5rem 1rem; 
            font-size: 1rem; 
            border-radius: 2rem;
        }
        #closeOverlay:hover {
            background-color: #000;
            transition: 1s;
        }
        .form-1, .form-2, .form-3 {
            display: flex;
            flex-direction: column; 
        }
        .form-4 {
            display: flex;
            flex-direction: row !important;
            justify-content: center !important;
            gap: 1rem;
        }
        .upload-container {
            background-color: #245F3E; 
            border: 2px dashed #aaa;
            padding: 0.75rem 1rem;
            display: inline-block;
            border-radius: 0.5rem;
            cursor: pointer;
            margin-top: 0.25rem;
            text-align: center;
            width: fit-content; 
            background-color: #f9f9f9;
        }
        .file-list {
            margin-top: 0rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .file-item {
            display: flex;
            align-items: center;
            border: 1px solid #ccc;
            border-radius: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: #fff;
            font-size: 0.9rem;
            width: auto;
        }
        .file-item span {
            margin-right: 0.5rem;
        }
        .remove-btn {
            background: none;
            border: none;
            color: red;
            font-size: 1rem;
            cursor: pointer;
        } 
        .search-container {
            width: 100%;
            display: flex;
            gap: 10px;
        }

        .search-bar {
            width: 100%;
            height: 52px;
            background: #F2F4F8;
            display: flex;
            align-items: center;
            padding: 0 16px;
            border-bottom: 1.09px solid #535353;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .search-bar input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 18px;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            color: #5A5252;
            padding: 0 10px;
        }
        .filter-dropdown {
            display: none;
            position: absolute;
            top: 620px;
            right: 60px;
            z-index: 1000;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
            padding: 24px 32px;
            min-width: 340px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            grid-gap: 24px;
        }

        .filter-dropdown label {
            font-weight: 500;
            color: #374151;
            display: flex;
            flex-direction: column;
        }

        .filter-dropdown select,
        .filter-dropdown input[type="date"] {
            width: 100%;
            margin-top: 6px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 15px;
            font-family: 'Inter', Arial, sans-serif;
            background: #f9f9f9;
            color: #374151;
        }

        .filter-dropdown select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            padding-right: 2rem;
            background: url("data:image/svg+xml;utf8,<svg width='16' height='11' viewBox='0 0 16 11' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M7.99976 7.19417L13.9025 1.29147C14.0125 1.17758 14.144 1.08674 14.2895 1.02424C14.435 0.961746 14.5915 0.92885 14.7498 0.927474C14.9082 0.926098 15.0652 0.95627 15.2117 1.01623C15.3583 1.07619 15.4914 1.16473 15.6034 1.27669C15.7153 1.38866 15.8039 1.5218 15.8638 1.66835C15.9238 1.8149 15.954 1.97192 15.9526 2.13026C15.9512 2.28859 15.9183 2.44506 15.8558 2.59055C15.7933 2.73604 15.7025 2.86762 15.5886 2.97762L8.84283 9.72339C8.61921 9.94694 8.31596 10.0725 7.99976 10.0725C7.68356 10.0725 7.38031 9.94694 7.15669 9.72339L0.41092 2.97762C0.297028 2.86762 0.206183 2.73604 0.143687 2.59055C0.0811915 2.44506 0.0482959 2.28859 0.04692 2.13026C0.0455441 1.97192 0.0757155 1.8149 0.135674 1.66835C0.195632 1.5218 0.284176 1.38866 0.39614 1.27669C0.508103 1.16473 0.641244 1.07619 0.787794 1.01623C0.934343 0.95627 1.09137 0.926098 1.2497 0.927474C1.40804 0.92885 1.56451 0.961746 1.71 1.02424C1.85548 1.08674 1.98706 1.17758 2.09706 1.29147L7.99976 7.19417Z' fill='%23374151'/></svg>")
                    no-repeat right 0.75rem center;
            background-size: 13px 8px;
        }

        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 24px;
        }

        .filter-apply {
            background: #063A1C;
            color: white;
            padding: 10px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Inter', Arial, sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            border: none;
        }

        .filter-close {
            background: #e5e7eb;
            color: #374151;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Inter', Arial, sans-serif;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>   
    <svg style="display: none;">
        <!-- ascdesc -->
        <symbol id="ascdesc" viewBox="0 0 640 640" fill="black">
            <path d="M342.6 81.4C330.1 68.9 309.8 68.9 297.3 81.4L137.3 241.4C124.8 253.9 124.8 274.2 137.3 286.7C149.8 299.2 170.1 299.2 182.6 286.7L288 181.3L288 552C288 569.7 302.3 584 320 584C337.7 584 352 569.7 352 552L352 181.3L457.4 286.7C469.9 299.2 490.2 299.2 502.7 286.7C515.2 274.2 515.2 253.9 502.7 241.4L342.7 81.4z"/> 
        </symbol> 
        <!-- expand -->
        <symbol id="expand" viewBox="0 0 640 640" fill="currentColor">
            <path d="M408 64L552 64C565.3 64 576 74.7 576 88L576 232C576 241.7 570.2 250.5 561.2 254.2C552.2 257.9 541.9 255.9 535 249L496 210L409 297C399.6 306.4 384.4 306.4 375.1 297L343.1 265C333.7 255.6 333.7 240.4 343.1 231.1L430.1 144.1L391.1 105.1C384.2 98.2 382.2 87.9 385.9 78.9C389.6 69.9 398.3 64 408 64zM232 576L88 576C74.7 576 64 565.3 64 552L64 408C64 398.3 69.8 389.5 78.8 385.8C87.8 382.1 98.1 384.2 105 391L144 430L231 343C240.4 333.6 255.6 333.6 264.9 343L296.9 375C306.3 384.4 306.3 399.6 296.9 408.9L209.9 495.9L248.9 534.9C255.8 541.8 257.8 552.1 254.1 561.1C250.4 570.1 241.7 576 232 576z"/>
        </symbol> 
        <!-- Search -->
        <symbol id="icon-search" viewBox="0 0 21 21" fill="none">
            <path d="M8.89152 15.9057C9.75056 15.9057 10.6012 15.7365 11.3948 15.4077C12.1885 15.079 12.9096 14.5972 13.5171 13.9897C14.1245 13.3823 14.6064 12.6612 14.9351 11.8675C15.2638 11.0739 15.433 10.2232 15.433 9.36417C15.433 8.50513 15.2638 7.6545 14.9351 6.86084C14.6064 6.06719 14.1245 5.34606 13.5171 4.73862C12.9096 4.13119 12.1885 3.64934 11.3948 3.3206C10.6012 2.99186 9.75056 2.82266 8.89152 2.82266C7.1566 2.82266 5.49274 3.51185 4.26597 4.73862C3.03919 5.9654 2.35 7.62926 2.35 9.36417C2.35 11.0991 3.03919 12.763 4.26597 13.9897C5.49274 15.2165 7.1566 15.9057 8.89152 15.9057V15.9057ZM15.7819 14.713L19.685 18.6161C19.7891 18.7167 19.872 18.8371 19.9291 18.9701C19.9861 19.1032 20.0161 19.2463 20.0173 19.391C20.0184 19.5358 19.9907 19.6793 19.9358 19.8133C19.8809 19.9472 19.7999 20.0689 19.6974 20.1712C19.595 20.2735 19.4732 20.3544 19.3392 20.4091C19.2052 20.4638 19.0616 20.4913 18.9168 20.4899C18.772 20.4886 18.629 20.4584 18.496 20.4012C18.3631 20.3439 18.2428 20.2608 18.1423 20.1566L14.2392 16.2535C12.4866 17.614 10.2814 18.2554 8.07247 18.0472C5.86357 17.839 3.81705 16.7968 2.34951 15.1328C0.881971 13.4688 0.103735 11.308 0.173229 9.09044C0.242723 6.87284 1.15472 4.76508 2.72357 3.19623C4.29242 1.62738 6.40018 0.715379 8.61778 0.645885C10.8354 0.576391 12.9961 1.35463 14.6601 2.82217C16.3241 4.28971 17.3663 6.33623 17.5745 8.54513C17.7827 10.754 17.1413 12.9592 15.7808 14.7119L15.7819 14.713Z" fill="#5A5252"/>
        </symbol>
        <!-- Filter -->
        <symbol id="icon-filter" viewBox="0 0 23 22" fill="none">
            <path opacity="0.9" d="M21.5399 1.92871H1.37988L9.44388 11.4644V18.0567L13.4759 20.0727V11.4644L21.5399 1.92871Z" stroke="#1E1E1E" stroke-width="2.016" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol> 
    </svg>  
    <header>
        <h1>test</h1>
    </header>
    
    <main>  
        <section> 
            <div class="tags"> 
                <content style="flex-grow: 2;"> 
                    <button class="campus">PSU - Tiniguiban</button>
                    <button class="agenda">Promotive and Preventive Health and Nutrition and Gender Sensitivity</button> 
                </content> 
                <content style="flex-grow: 0;"> 
                    <button class="status">Completed</button> 
                </content>
            </div> 
            <div> 
                <a href="#" class="title">The Idler Wheel Is Wiser Than the Driver of the Screw and Whipping Cords Will Serve You More Than Ropes Will</a>
                <h5>January 01, 2024 - January 02, 2024</h5>
            </div> 
            {% if providers_complete %}
            <div class="project-authors"> 
                {% for provider in providers %}
                <content>
                    <img src="{{ provider.profile_picture_or_initial }}" alt="{{ provider.get_full_name }}">
                    <a href="#">{{ provider.get_full_name }}</a> 
                </content>
                {% endfor %}
                <div class="expense-add"> 
                    <button type="button">Add Expense</button>
                </div>
            </div>
            {% else %}
            <div class="project-authors">
                <content>
                    <a href="#">Providers not set yet for this project.</a>
                </content>
                <div class="expense-add"> 
                    <button type="button">Add Expense</button>
                </div>
            </div>
            {% endif %}
            <div class="tabs">  
                <button type="button" data-tab="overview">Overview</button>
                <button type="button" data-tab="invoices">Invoices</button>
            </div>
        </section> 
        <section class="tab-contents-section"> 
            <div> 
                <div class="tab-content active" id="overview">
                    <div class="project-content">
                        <section class="project-summary"> 
                            <div class="chart-wrapper">
                                <div class="chart-container">
                                    <canvas id="goal1"></canvas>
                                </div>
                                <div class="cash-available">
                                    <p>Current Budget: <strong>‚Ç± {{ remaining_budget|floatformat:2 }}</strong></p>
                                </div>
                                <div class="goal-title">
                                </div>
                            </div>
                        </section>
                        <section class="logs"> 
                            <table id="overviewTable" style="width:100%">
                                <colgroup>
                                    <col style="width: 33%">
                                    <col style="width: 33%">
                                    <col style="width: 34%">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th>Reason</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                </tr>
                                <tbody id="overviewTbody">
                                {% for expense in expenses %}
                                <tr>
                                    <td>{{ expense.title }}</td>
                                    <td>‚Ç± {{ expense.amount|floatformat:2 }}</td>
                                    <td>{{ expense.date_incurred|date:"m/d/Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="3">No expenses recorded yet.</td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                            <div class="pagination" id="overviewPagination" style="padding: 0.75rem 1rem;"></div>
                        </section>
                    </div>
                </div>
                
                <div class="tab-content" id="invoices">
                    <div class="search-container">
                        <form class="search-bar" method="get" action="">
                            <svg width="20" height="20"> <use href="#icon-search"></use> </svg>
                            <input type="text" name="search" placeholder="Search by file name..." value="{{ search|default:'' }}"/>
                            <input type="hidden" name="tab" id="activeTabInput" value="files" />
                            <button type="button" id="filterBtn" style="background:none;border:none;padding:0;margin-right:5px;cursor:pointer;">
                                <svg width="20" height="20"> <use href="#icon-filter"></use> </svg>
                            </button>
                            <div id="filterDropdown" class="filter-dropdown">
                                <div class="filter-grid" style="grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; grid-gap: 24px;">
                                    <!-- Top Left - Sort By -->
                                    <label>Sort By
                                        <select name="sort_by">
                                            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>File Name</option>
                                            <option value="file_type" {% if sort_by == 'file_type' %}selected{% endif %}>File Type</option>
                                            <option value="size" {% if sort_by == 'size' %}selected{% endif %}>Size</option>
                                            <option value="date" {% if sort_by == 'date' %}selected{% endif %}>Date</option>
                                        </select>
                                    </label>
                                    <!-- Top Right - Order By -->
                                    <label>Order By
                                        <select name="order">
                                            <option value="asc" {% if order == 'asc' %}selected{% endif %}>Ascending</option>
                                            <option value="desc" {% if order == 'desc' %}selected{% endif %}>Descending</option>
                                        </select>
                                    </label>
                                    <!-- Bottom Left - File Type Filter -->
                                    <label>File Type
                                        <select name="file_type">
                                            <option value="">All Types</option>
                                            {% for ext in file_types %}
                                            <option value="{{ ext }}" {% if file_type == ext %}selected{% endif %}>{{ ext|upper }}</option>
                                            {% endfor %}
                                        </select>
                                    </label>
                                    <!-- Bottom Right - Date Filter -->
                                    <label>Date
                                        <input type="date" name="date" value="{{ date|default:'' }}" style="width: 87%"/>
                                    </label>
                                </div>
                                <div class="filter-actions">
                                    <button type="submit" class="filter-apply">Apply</button>
                                    <button type="button" id="closeFilter" class="filter-close">Close</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="files-header">
                        <h3>Files</h3>
                        <div style="display: flex; flex-shrink: 3;">
                        <svg width="20" height="20" style="fill: currentColor;">
                            <use href="#acsdecs"/>
                        </svg>
                        <div class="dropdown2">
                            <button class="dropdown-btn2">Sort by ‚ñæ</button>
                            <div class="dropdown-menu2 hidden">
                                <div class="dropdown-item2">Name</div>
                                <div class="dropdown-item2">Date Completed</div>
                                <div class="dropdown-item2">Last Updated</div>
                                <div class="dropdown-item2">Q4</div>
                            </div>
                        </div> 
                    </div>
                    </div>
                    <div class="file-list" id="fileList"></div>

                    <script>
                    // Example data 
                    const files = [
                        { title: "Receipt", date: "January 01, 2024" },
                        { title: "Receipt", date: "January 02, 2024" },
                        { title: "Project Proposal", date: "January 03, 2024" },
                        { title: "Meeting Notes", date: "January 04, 2024" },
                        { title: "Summary Report", date: "January 05, 2024" }
                    ];

                    const fileList = document.getElementById("fileList");

                    files.forEach(file => {
                        const card = document.createElement("div");
                        card.classList.add("file-card");

                        card.innerHTML = `
                        <img src="https://d9-wret.s3.us-west-2.amazonaws.com/assets/palladium/production/s3fs-public/thumbnails/image/file.jpg" alt="File preview">
                        <h4>${file.title}</h4>
                        <p>Date added: <strong>${file.date}</strong></p>
                        `;

                        fileList.appendChild(card);
                    });
                    </script>
                </div>
            </div>
        </section> 
        <!-- Overlay background -->
        <div id="overlay" class="overlay hidden">
            <!-- Form container -->
            <div class="overlay-content">
                <button type="button" class="close-x" id="closeX" aria-label="Close">&times;</button>
                <h2>Add Expense</h2>
                <form class="expenseForm" id="expenseForm" enctype="multipart/form-data">
                    <div class="form-1">
                        <label for="reason">Reason:</label>
                        <input type="text" id="reason" name="reason" placeholder="Meals"required>

                        <label for="amount">Total Expense (‚Ç±):</label>
                        <input type="number" id="amount" name="amount" step="0.01" placeholder="100.00"required>      
                    </div>
                    <div class="form-2">
                        <label for="receipt">Upload Receipt/s of Expenses:</label>
                        <label class="upload-container">
                            <input type="file" id="receipt" name="receipt" accept="image/*,.pdf" hidden>
                            üì§ Click to upload
                        </label>
                        <div class="file-list" id="fileListOverlay"></div>
                    </div>
                    <div class="form-3">
                        <label for="notes">Notes:</label>
                        <textarea id="notes" name="notes" rows="3" placeholder="(e.g. Bento box)"></textarea>
                    </div>
                    <div class="form-4">
                        <button type="submit" id="submitexpense">Submit</button>
                        <button type="button" id="closeOverlay">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </main>
    <footer>
        <p>test</p>
    </footer> 
    <script>
        // Pass Django data to JavaScript
        const projectData = {
            budgetPercentage: Number('{{ budget_percentage|default:0 }}'),
            totalBudget: Number('{{ total_budget|default:0 }}'),
            totalSpent: Number('{{ total_spent|default:0 }}'),
            remainingBudget: Number('{{ remaining_budget|default:0 }}')
        };
        
        // Projects list removed with dropdown
        
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        async function submitExpense(event) {
            event.preventDefault();
            const formData = new FormData();
            formData.append('reason', document.getElementById('reason').value);
            formData.append('amount', document.getElementById('amount').value);
            formData.append('notes', document.getElementById('notes').value);
            const today = new Date().toISOString().slice(0,10);
            formData.append('date', today);
            const receiptInput = document.getElementById('receipt');
            if (receiptInput.files && receiptInput.files[0]) {
                formData.append('receipt', receiptInput.files[0]);
            }
            const resp = await fetch(window.location.pathname + 'add-expense/', {
                method: 'POST',
                headers: { 'X-CSRFToken': getCookie('csrftoken') },
                body: formData
            });
            const data = await resp.json();
            if (!resp.ok || !data.ok) {
                alert(data.error || 'Failed to add expense');
                return;
            }
            window.location.reload();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const expForm = document.getElementById('expenseForm');
            if (expForm) expForm.addEventListener('submit', submitExpense);
            
            // Project selector removed
            
            const tabs = document.querySelectorAll('.tabs button');
            const tabContents = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    tabContents.forEach(content => content.classList.remove('active'));
                    const target = this.getAttribute('data-tab');
                    document.getElementById(target).classList.add('active');
                });
            });
            if (tabs.length > 0) {
                tabs[0].classList.add('active');
                const firstTab = tabs[0].getAttribute('data-tab');
                document.getElementById(firstTab).classList.add('active');
            }
            // Setup overlay close handlers (X, Cancel, backdrop, Esc)
            setupOverlay();
        });  
        function setupOverlay() {
            const overlay = document.getElementById('overlay');
            if (!overlay) return;
            const closeXBtn = document.getElementById('closeX');
            const cancelBtn = document.getElementById('closeOverlay');
            const addHidden = () => overlay.classList.add('hidden');
            if (closeXBtn) closeXBtn.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); addHidden(); });
            if (cancelBtn) cancelBtn.addEventListener('click', (e) => { e.preventDefault(); e.stopPropagation(); addHidden(); });
            overlay.addEventListener('click', (e) => { if (e.target === overlay) addHidden(); });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') addHidden(); });
        }
        const centerTextPlugin = {
            id: 'centerText',
            beforeDraw(chart) {
                const { width, height, ctx } = chart;
                ctx.save();
                const dataset = chart.data.datasets[0].data;
                const value = dataset[0];
                ctx.font = 'bold 3rem Arial'; // bold text
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(value + '%', width / 2, height / 2);
                ctx.restore();

                // Also update the HTML text below the chart
                const goalText = document.querySelector('.goal-title');
                if(goalText) {
                    goalText.innerHTML = `Your project currently has <b>${value}%</b> of its initial budget remaining.`;
                }
            }
        };

        function createFullDoughnut(ctx, value) {
            return new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [value, 100 - value],
                        backgroundColor: ['darkblue', '#000000'],
                        borderWidth: 0
                    }]
                },
                options: {
                    rotation: -90,
                    circumference: 360,
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                },
                plugins: [centerTextPlugin]
            });
        }

        // DATA - Use dynamic budget percentage
        createFullDoughnut(document.getElementById('goal1').getContext('2d'), projectData.budgetPercentage);     
         
        // Remove the overlay click event listener and update the button handlers
        const addBtn = document.querySelector('.expense-add button');
        const overlay = document.getElementById('overlay');
        const closeBtn = document.getElementById('closeOverlay');

        addBtn.addEventListener('click', () => {
            overlay.classList.remove('hidden');
        });

        closeBtn.addEventListener('click', () => {
            overlay.classList.add('hidden');
        });


        // Add this to your existing script section (guarded in case button doesn't exist)
        const expandBtnEl = document.querySelector('.expand-btn');
        if (expandBtnEl) {
            expandBtnEl.addEventListener('click', function() {
                const expensesTab = document.querySelector('button[data-tab="expenses"]');
                if (expensesTab) expensesTab.click();
                const expensesSection = document.querySelector('#expenses');
                if (expensesSection) expensesSection.scrollIntoView({ behavior: 'smooth' });
            });
        }
        // Add this to your existing script section
        const closeX = document.getElementById('closeX');
            closeX.addEventListener('click', () => {
            overlay.classList.add('hidden');
        });

        const fileInput = document.getElementById("receipt");
        const fileListEl = document.getElementById("fileListOverlay"); // fixed ID
        let uploadedFiles = [];

        fileInput.addEventListener("change", (event) => {
        const newFiles = Array.from(event.target.files);
        uploadedFiles = [...uploadedFiles, ...newFiles];
        renderFileList();
        fileInput.value = ""; // allow re-selecting same file
        });

        function renderFileList() {
        fileListEl.innerHTML = "";
        uploadedFiles.forEach((file, index) => {
            const fileItem = document.createElement("div");
            fileItem.className = "file-item";
            fileItem.innerHTML = `
            <span>${file.name}</span>
            <button type="button" class="remove-btn" onclick="removeFile(${index})">‚ùå</button>
            `;
            fileListEl.appendChild(fileItem);
        });
        }

        // Client-side pagination for Overview expenses table with Prev/Next and ellipses
        (function setupOverviewPagination(){
            const tbody = document.getElementById('overviewTbody');
            if (!tbody) return;
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const pageSize = 5;
            let current = 1;

            function renderPage(page){
                const totalPages = Math.max(1, Math.ceil(rows.length / pageSize));
                current = Math.min(Math.max(1, page), totalPages);
                const start = (current - 1) * pageSize;
                const end = start + pageSize;
                rows.forEach((tr, i) => {
                    tr.style.display = (i >= start && i < end) ? '' : 'none';
                });
                renderControls(totalPages);
            }

            function addPageBtn(container, label, page, disabled=false, active=false){
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.textContent = label;
                btn.style.marginRight = '0.5rem';
                btn.style.padding = '0.35rem 0.7rem';
                btn.style.borderRadius = '0.6rem';
                btn.style.border = active ? '1px solid #1e1e1e' : '1px solid #d1d5db';
                btn.style.background = active ? '#2f2f2f' : '#ffffff';
                btn.style.color = active ? '#ffffff' : '#111827';
                btn.style.opacity = disabled ? '0.5' : '1';
                btn.style.cursor = disabled ? 'default' : 'pointer';
                if (!disabled && !active) btn.addEventListener('click', () => renderPage(page));
                container.appendChild(btn);
            }

            function renderControls(totalPages){
                const container = document.getElementById('overviewPagination');
                if (!container) return;
                container.innerHTML = '';
                // ensure it is visible and styled
                container.style.display = 'flex';
                container.style.alignItems = 'center';
                container.style.justifyContent = 'center';
                container.style.gap = '0.75rem';
                container.style.width = '100%';
                container.style.marginTop = '0.5rem';

                // Prev
                addPageBtn(container, '‚Üê Previous', current - 1, current === 1, false);

                // Page numbers with ellipses
                const pages = computePages(totalPages, current);
                pages.forEach(p => {
                    if (p === '‚Ä¶'){
                        const span = document.createElement('span');
                        span.textContent = '‚Ä¶';
                        span.style.marginRight = '0.5rem';
                        container.appendChild(span);
                    } else {
                        addPageBtn(container, String(p), p, false, p === current);
                    }
                });

                // Next
                addPageBtn(container, 'Next ‚Üí', current + 1, current === totalPages, false);
            }

            function computePages(total, current){
                const windowSize = 1; // show current-1, current, current+1
                const pages = [];
                const add = (n) => { if (!pages.includes(n)) pages.push(n); };
                add(1);
                add(total);
                for (let i = current - windowSize; i <= current + windowSize; i++){
                    if (i > 1 && i < total) add(i);
                }
                pages.sort((a,b)=>a-b);
                // insert ellipses
                const result = [];
                for (let i = 0; i < pages.length; i++){
                    result.push(pages[i]);
                    if (i < pages.length - 1 && pages[i+1] - pages[i] > 1) result.push('‚Ä¶');
                }
                // ensure at least three visible numbers: 1, 2, and Next layout
                if (result.length === 1) {
                    result.push(2);
                }
                return result;
            }

            renderPage(1);
        })();

        function removeFile(index) {
        uploadedFiles.splice(index, 1);
        renderFileList();
        }
    </script>
</body>
</html>