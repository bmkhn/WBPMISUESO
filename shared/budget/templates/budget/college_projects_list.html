{% extends base_template %}
{% load static %}
{% load humanize %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/budget/styles.css' %}" rel="stylesheet">

<div class="main-container">
    
    <div class="container-1">
        <div class="container-1A">
            <h1 class="welcome-text">{{ title }}</h1>
        </div>
    </div>

    <div class="another-header">
        <h2>Projects</h2>
        <div class="container-1B">
            <a class="export-btn view" href="{% url 'budget_dashboard' %}">
                <i class="fa-solid fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </div>

    <div class="table-container">
        <div class="table-wrapper">
            <table class="user-table">
                <thead>
                    <tr>
                        <th>Project Title</th>
                        <th>Project Leader</th>
                        <th>Status</th>
                        <th>Internal Funding</th>
                        <th>External Funding</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in projects %}
                    {# CRITICAL: Add clickable class and project ID for JS to use #}
                    <tr class="project-clickable-row" data-project-id="{{ project.id }}">
                        <td>{{ project.title }}</td>
                        <td>{{ project.project_leader }}</td>
                        <td>{{ project.get_status_display }}</td>
                        <td>₱{{ project.internal_budget|intcomma }}</td>
                        <td>₱{{ project.external_budget|intcomma }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center" style="color: #6b7280; padding: 20px;">
                            No funded projects found for {{ college_name }} in {{ fiscal_year }}.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function attachProjectClickListeners() {

            const rows = document.querySelectorAll('.project-clickable-row');
            
            rows.forEach(row => {
                if (!row.dataset.hasClickListener) { 
                    row.addEventListener('click', () => {
                        const projectId = row.dataset.projectId;
                        if (projectId) {
                            window.location.href = `/projects/${projectId}/`; 
                        }
                    });
                    row.dataset.hasClickListener = 'true';
                }
            });
        }
        document.addEventListener('DOMContentLoaded', () => {
            attachProjectClickListeners();
        });
    </script>
</div>
{% endblock %}