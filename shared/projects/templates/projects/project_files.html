{% extends "projects/base_project_profile.html" %}
{% block profile_content %}
{% load static %} 
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/projects/view.css' %}" rel="stylesheet">

<!-- Search Bar & Filter (2x2 Grid) -->
<div class="search-container">
    <form class="search-bar" method="get" action="">
        <svg width="16" height="16"> <use href="#icon-search"></use> </svg>
        <input type="text" name="search" placeholder="Search File Name" value="{{ request.GET.search|default:'' }}"/>
        <button type="button" id="filterBtn" style="background:none;border:none;padding:0;margin-right:5px;cursor:pointer;">
            <svg width="16" height="16"> <use href="#icon-filter"></use> </svg>
        </button>
        <div id="filterDropdown" class="filter-dropdown" style="top: 455px;">
            <div class="filter-grid" style="grid-template-columns: repeat(3, 1fr); grid-template-rows: auto; grid-gap: 24px;">
                <!-- Top Left - Sort By -->
                <label>Sort By
                    <select name="sort_by">
                        <option value="name" {% if request.GET.sort_by == 'name' %}selected{% endif %}>File Name</option>
                        <option value="file_type" {% if request.GET.sort_by == 'file_type' %}selected{% endif %}>File Type</option>
                        <option value="size" {% if request.GET.sort_by == 'size' %}selected{% endif %}>Size</option>
                        <option value="date" {% if request.GET.sort_by == 'date' %}selected{% endif %}>Date</option>
                    </select>
                </label>
                <!-- Top Right - Order By -->
                <label>Order By
                    <select name="order">
                        <option value="asc" {% if request.GET.order == 'asc' %}selected{% endif %}>Ascending</option>
                        <option value="desc" {% if request.GET.order == 'desc' %}selected{% endif %}>Descending</option>
                    </select>
                </label>
                <!-- Bottom Left - File Type Filter -->
                <label>File Type
                    <select name="file_type">
                        <option value="">All Types</option>
                        {% for ext in file_types %}
                        <option value="{{ ext }}" {% if request.GET.file_type == ext %}selected{% endif %}>{{ ext|upper }}</option>
                        {% endfor %}
                    </select>
                </label>
            </div>
            <div class="filter-actions">
                <button type="submit" class="filter-apply">Apply</button>
                <button type="button" id="closeFilter" class="filter-close">Clear Filters</button>
            </div>
        </div>
    </form>
</div>

<div class="card-header">
    <h3>Files</h3>
</div>

<div style="margin-top:2rem;">
    <div class="file-list">
        {% for file in files %}
        <div class="file-card">
            <a href="{{ file.file.url }}" target="_blank">
                {% if file.extension in 'jpg jpeg png gif bmp webp' %}
                    <img src="{{ file.file.url }}" alt="Image Preview">
                {% elif file.extension == 'pdf' %}
                    <div style="width:100%;height:8rem;display:flex;align-items:center;justify-content:center;">
                       <i class="fa-regular fa-file-pdf" style="font-size:3rem;color:#d32f2f;"></i>
                    </div>
                {% else %}
                    <div style="width:100%;height:8rem;display:flex;align-items:center;justify-content:center;">
                        <i class="fa-regular fa-file" style="font-size:3rem;color:#aaa;"></i>
                    </div>
                {% endif %}
            </a>
            <h4><a href="{{ file.file.url }}" class="name-link" target="_blank">{{ file.name }}</a></h4>
            <p>{{ file.extension|upper }} &bull; {{ file.size }} &bull; {{ file.uploaded_at|date:'M d, Y' }}</p>
        </div>
        {% empty %}
        <div style="grid-column:1/-1;text-align:center;color:#888;font-size:1.1rem;">No files found.</div>
        {% endfor %}
    </div>
</div>

<!-- Pagination -->
<div class="pagination-container">
    {% if page_obj.has_previous %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page=1">First</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
    {% else %}
        <button class="pagination-button" disabled>First</button>
        <button class="pagination-button" disabled>Previous</button>
    {% endif %}

    {% for num in page_range %}
        {% if num == page_obj.number %}
            <button class="pagination-button active" disabled>{{ num }}</button>
        {% else %}
            <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
        {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
        <a class="pagination-button" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ paginator.num_pages }}">Last</a>
    {% else %}
        <button class="pagination-button" disabled>Next</button>
        <button class="pagination-button" disabled>Last</button>
    {% endif %}
</div>

{% endblock %}
