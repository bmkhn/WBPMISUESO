{% extends base_template %}
{% load static %}

{% block title %}Delete My Account{% endblock %}

{% block content %}
<!-- 
  This link is REQUIRED for all the icons (fas fa-school, etc.)
  in the file to appear.
-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<!-- 
  EMBEDDED STYLES:
  Copied from settings.html to ensure consistent look and feel.
-->
<style>
/* --- 1. Global & Page Layout --- */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

body {
    background: #f8f8f8 !important; 
    font-family: 'Inter', sans-serif !important;
}

.main-container {
    margin: 2rem 4rem 4rem 4rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem; 
}

.project-text {
    color: #000;
    font-family: 'Inter', Arial, sans-serif;
    margin: 0 0 1rem 0;
    font-size: 1.85rem;
    font-weight: 700;
}

/* Base paragraph style */
p {
    color: #555;
    font-size: 0.95rem;
    line-height: 1.6;
}
/* Paragraphs inside accordion content */
.accordion-content > p {
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    line-height: 1.6;
}


/* --- 2. Modern Card Styling (with Soft Shadows) --- */
.card {
    background: #FFFFFF;
    border: 1px solid #EAEAEA; /* Subtle border */
    border-radius: 8px; /* Rounded corners */
    /* Soft, professional shadow */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    margin-bottom: 1.5rem; 
    /* FIX: Make border persistent */
    border-left: 4px solid transparent;
    transition: box-shadow 0.2s ease-in-out;
}

/* FIX: Persistent border for main cards */
.col-lg-8 > .card {
    border-left-color: #0A6C44;
}

.card:hover {
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.07);
}

.card-header {
    background-color: #FFFFFF;
    border-bottom: 1px solid #EAEAEA;
    padding: 1rem 1.5rem;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.card-header h6 {
    color: #0A6C44 !important; /* Primary Green */
    font-weight: 700;
    font-size: 1.1rem;
    margin: 0;
}

.card-body {
    padding: 1.5rem;
}

/* --- 3. Brand Button Overrides --- */
.btn {
    border-radius: 6px;
    padding: 0.6rem 1.25rem;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.2s ease-in-out;
    text-transform: none; 
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}
.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
}
/* This is the new, simpler "Add" button style */
.btn-primary { 
    background-color: #0A6C44; border-color: #0A6C44; color: #fff !important; 
    display: inline-flex;
    align-items: center;
}
.btn-primary:hover { background-color: #085837; border-color: #085837; }
.btn-primary .fa-plus {
    margin-right: 0.5rem;
}
.btn-primary .fa-save {
    margin-right: 0.5rem;
}

/* Warning (Orange/Amber) */
.btn-warning { background-color: #B65900; border-color: #B65900; color: #fff !important; }
.btn-warning:hover { background-color: #934800; border-color: #934800; }

/* Danger (Red) */
.btn-danger { background-color: #DC2626; border-color: #DC2626; color: #fff !important; }
.btn-danger:hover { background-color: #b01e1e; border-color: #b01e1e; }

/* Secondary (Gray) */
.btn-secondary { background-color: #f8f9fc; border-color: #e3e6f0; color: #5a5c69 !important; }
.btn-secondary:hover { background-color: #e3e6f0; border-color: #e3e6f0; color: #3a3b45 !important; }


/* --- 5. Admin Settings Accordion (NEW CUSTOM JS STYLE) --- */

/* This is the header for ALL sections */
.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 1.25rem 1.5rem;
    text-align: left;
    color: #333;
    border: none;
    transition: background-color 0.2s ease-in-out;
    /* Only top corners are rounded */
    border-radius: 8px 8px 0 0;
    /* FIX: Always-on background color */
    background-color: #f8f9fa;
}
/* Wrapper for the text content in the header */
.section-header-content {
    pointer-events: none;
}

/* This is the clickable header button */
.accordion-toggle {
    cursor: pointer;
}
.accordion-toggle:hover {
    background-color: #f1f3f5; /* Darker hover */
    text-decoration: none;
}

/* This is the non-clickable header for API section */
.section-header.non-collapsible {
    background-color: #f8f9fa; /* Match active bg */
}
.section-header.non-collapsible .accordion-title {
    color: #0A6C44; /* Match active title */
}

/* Title inside the button */
.accordion-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0;
    pointer-events: none; /* Make text non-clickable */
    /* FIX: Always-on green title color */
    color: #0A6C44;
}
/* Description text (short) inside the button */
.accordion-desc {
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.25rem;
    font-weight: 400;
    pointer-events: none; /* Make text non-clickable */
    padding: 0;
    line-height: 1.4;
}

/* FIX: This is the new, always-visible description section */
.section-description {
    background: #fff;
    padding: 1.25rem 1.5rem;
    border-top: 1px solid #EAEAEA;
    /* FIX: Always-on background color */
    background-color: #f8f9fa;
}

/* FIX: Style for the long intro paragraph */
.accordion-intro {
    font-size: 0.9rem;
    line-height: 1.6;
    color: #555;
    margin: 0; /* Remove default p margin */
}


/* Custom Chevron Icon */
.accordion-chevron {
    font-size: 1rem;
    color: #0A6C44; /* Primary Green */
    transition: transform 0.25s ease-in-out;
    pointer-events: none; /* Make text non-clickable */
    margin-left: 1rem; /* Add space between text and icon */
}

/* STYLING FOR THE "ACTIVE" (OPEN) STATE */
.accordion-toggle.active {
    background-color: #f8f9fa;
}
.accordion-toggle.active + .section-description {
    /* When open, description matches header bg */
    background-color: #f8f9fa;
}
.accordion-toggle.active .accordion-chevron {
    transform: rotate(-180deg);
}

/* Accordion Content Area (this is the part that hides/shows) */
.accordion-content {
    background-color: #fff;
    border-top: 1px solid #EAEAEA;
    padding: 1.5rem;
    /* Need to add bottom rounded corners */
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
}
/* Wrapper for "Add" button to push to the right */
.card-body .table-controls,
.accordion-content .table-controls {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 1.5rem;
}

/* --- 6. Table Styles (FORMAL STYLE) --- */
.table-responsive {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    overflow: hidden; /* This is crucial */
}

.table {
    border-collapse: collapse;
    margin-bottom: 0; /* Remove default margin */
}

.table thead th {
    background: #f8f9fa; /* Light formal header */
    border-bottom: 2px solid #dee2e6; /* Stronger header line */
    border-top: none;
    font-size: 0.85rem;
    color: #333; /* Dark text */
    font-weight: 700;
    text-transform: uppercase; /* Formal */
    letter-spacing: 0.5px;
    padding: 0.85rem 1.5rem; /* Reduced padding */
    vertical-align: bottom;
}

.table tbody tr {
    border-bottom: 1px solid #e9ecef; /* Row separator */
}
.table tbody tr:last-child {
    border-bottom: none;
}
.table tbody tr:hover {
    background-color: transparent;
    box-shadow: none;
    transform: none;
    cursor: default;
}

.table td,
.table th {
    vertical-align: middle !important;
    padding: 0.85rem 1.5rem; /* Reduced padding */
    color: #333;
    font-size: 0.95rem;
}
.table td:hover {
    padding: 0.85rem 1.5rem; /* Stop padding change on hover */
}

/* Class to right-align action cells */
.table th.cell-actions,
.table td.cell-actions {
    text-align: right;
    width: 1%; /* Shrink to fit content */
    white-space: nowrap;
}

/* Constrain logo size in the table */
.table .cell-logo { width: 80px; }
.table .cell-logo img {
    max-height: 40px; max-width: 60px; width: auto; height: auto;
    border-radius: 4px; object-fit: contain; background: #f8f8f8;
    border: 1px solid #eee; padding: 2px;
}
.table .cell-no-logo {
    color: #999; font-style: italic; font-size: 0.85rem;
}

/* --- 7. Action Button Outline Styles --- */
.table .btn {
    background: transparent !important;
    border: 1px solid;
    box-shadow: none;
    padding: 0.35rem 0.6rem;
    font-size: 0.8rem;
}
.table .btn:hover {
    background: #f8f8f8 !important;
    transform: none;
    box-shadow: none;
}

.table .btn-outline-warning {
    color: #B65900 !important;
    border-color: #B65900;
}
.table .btn-outline-warning:hover {
    color: #934800 !important;
    border-color: #934800;
}

.table .btn-outline-danger {
    color: #DC2626 !important;
    border-color: #DC2626;
}
.table .btn-outline-danger:hover {
    color: #b01e1e !important;
    border-color: #b01e1e;
}


/* --- 8. API & General Settings Forms --- */
.form-group label,
.form-group .form-label {
    font-weight: 600; color: #333;
    font-size: 0.9rem; margin-bottom: 0.5rem;
}
.form-control {
    border-radius: 6px; padding: 0.6rem 1rem;
    height: auto; font-size: 0.95rem;
    border: 1px solid #ced4da;
}
.form-control:focus {
    border-color: #0A6C44;
    box-shadow: 0 0 0 0.2rem rgba(10, 108, 68, 0.25);
}

/* Horizontal form row for General Settings */
.form-row-label {
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
}
.form-row-desc {
    font-size: 0.85rem;
    color: #666;
    font-weight: 400;
    /* FIX: Added margin-top */
    margin-top: 0.35rem;
}

@media (min-width: 768px) {
    .api-password-form { display: flex; align-items: center; }
    .api-password-form .form-group {
        flex-grow: 1; margin-bottom: 0; margin-right: 1rem;
    }
    .api-password-form .btn-primary {
        width: auto; flex-shrink: 0;
        padding-top: 0.6rem; padding-bottom: 0.6rem;
    }
}

/* --- 9. Danger Zone (Right Column) --- */
#danger-zone {
    border: 1px solid #fde8e8;
    border-left: 4px solid #DC2626;
    box-shadow: none;
}
/* FIX: Override hover color for danger zone */
#danger-zone:hover {
    border-left-color: #DC2626;
}
#danger-zone .card-header { background-color: #fef2f2; }
#danger-zone .card-header h6 { color: #DC2626 !important; }

/* --- 10. Alert Messages --- */
.alert {
    border-radius: 6px; font-weight: 500; border: none;
    padding: 1rem 1.25rem;
}
.alert-success { background-color: #E6F4EA; color: #0A6C44; }
.alert-danger { background-color: #fef2f2; color: #DC2626; }
.alert-warning { background-color: #fffbeb; color: #B65900; }
.alert .close {
    font-size: 1.5rem; color: inherit; opacity: 0.7;
    text-shadow: none; font-weight: 700;
}
.alert .close:hover { opacity: 1; }

</style>
<!-- END OF EMBEDDED STYLES -->


<!-- FIX: Changed container-fluid to main-container -->
<div class="main-container">

    <!-- FIX: Changed h3 to h1.project-text -->
    <h1 class="project-text">Delete My Account</h1>

    <div class="row">
        <div class="col-lg-8">
            <!-- 
              FIX: Replaced old card classes with the new id="danger-zone"
              to match the settings page style.
            -->
            <div class="card" id="danger-zone">
                <div class="card-header">
                    <h6 class="m-0 text-danger">Warning: This action is permanent</h6>
                </div>
                <div class="card-body">
                    <p>You are about to permanently delete your account: <strong>{{ user.get_full_name }} ({{ user.email }})</strong>.</p>
                    <p>When you delete your account, all of your personal information, profile data, and associated content will be permanently removed. This action <strong>cannot be undone</strong>.</p>
                    <p>If you are sure you want to proceed, please enter your current password below to confirm.</p>
                    
                    <form method="POST">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}

                        <div class="form-group">
                            <!-- FIX: Added .form-label class -->
                            <label for="{{ form.password.id_for_label }}" class="form-label">{{ form.password.label }}</label>
                            
                            <!-- FIX: Manually adding .form-control class to Django field -->
                            {{ form.password.as_widget.attrs.class }}
                            <input type="password" name="{{ form.password.name }}" id="{{ form.password.id_for_label }}" class="form-control" required>
                            
                            {% if form.password.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.password.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <hr>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <!-- FIX: Button styles will be applied automatically -->
                            <a href="{% url 'system_settings:settings' %}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash" style="margin-right: 0.5rem;"></i>
                                Yes, Permanently Delete My Account
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}
