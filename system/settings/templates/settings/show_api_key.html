{% extends base_template %}
{% load static %}

{% block title %}API Key Generated{% endblock %}

{% block content %}
<!-- 
  This link is REQUIRED for all the icons (fas fa-save, etc.)
  in the file to appear.
-->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<!-- 
  EMBEDDED STYLES:
  Copied from settings.html to ensure consistent look and feel.
-->
<style>
/* --- 1. Global & Page Layout --- */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

body {
    background: #f8f8f8 !important; 
    font-family: 'Inter', sans-serif !important;
}

.main-container {
    margin: 2rem 4rem 4rem 4rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem; 
}

.project-text {
    color: #000;
    font-family: 'Inter', Arial, sans-serif;
    margin: 0 0 1rem 0;
    font-size: 1.85rem;
    font-weight: 700;
}

/* Base paragraph style */
p {
    color: #555;
    font-size: 0.95rem;
    line-height: 1.6;
}
/* Paragraphs inside accordion content */
.accordion-content > p {
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    line-height: 1.6;
}


/* --- 2. Modern Card Styling (with Soft Shadows) --- */
.card {
    background: #FFFFFF;
    border: 1px solid #EAEAEA; /* Subtle border */
    border-radius: 8px; /* Rounded corners */
    /* Soft, professional shadow */
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    margin-bottom: 1.5rem; 
    /* FIX: Make border persistent */
    border-left: 4px solid transparent;
    transition: box-shadow 0.2s ease-in-out;
}

/* FIX: Persistent border for main cards */
.col-lg-8 > .card {
    border-left-color: #0A6C44;
}

.card:hover {
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.07);
}

.card-header {
    background-color: #FFFFFF;
    border-bottom: 1px solid #EAEAEA;
    padding: 1rem 1.5rem;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.card-header h6 {
    color: #0A6C44 !important; /* Primary Green */
    font-weight: 700;
    font-size: 1.1rem;
    margin: 0;
}

.card-body {
    padding: 1.5rem;
}

/* --- 3. Brand Button Overrides --- */
.btn {
    border-radius: 6px;
    padding: 0.6rem 1.25rem;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.2s ease-in-out;
    text-transform: none; 
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}
.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
}
/* This is the new, simpler "Add" button style */
.btn-primary { 
    background-color: #0A6C44; border-color: #0A6C44; color: #fff !important; 
    display: inline-flex;
    align-items: center;
}
.btn-primary:hover { background-color: #085837; border-color: #085837; }
.btn-primary .fa-plus {
    margin-right: 0.5rem;
}
.btn-primary .fa-save {
    margin-right: 0.5rem;
}

/* Warning (Orange/Amber) */
.btn-warning { background-color: #B65900; border-color: #B65900; color: #fff !important; }
.btn-warning:hover { background-color: #934800; border-color: #934800; }

/* Danger (Red) */
.btn-danger { background-color: #DC2626; border-color: #DC2626; color: #fff !important; }
.btn-danger:hover { background-color: #b01e1e; border-color: #b01e1e; }

/* Secondary (Gray) */
.btn-secondary { background-color: #f8f9fc; border-color: #e3e6f0; color: #5a5c69 !important; }
.btn-secondary:hover { background-color: #e3e6f0; border-color: #e3e6f0; color: #3a3b45 !important; }


/* --- 8. API & General Settings Forms --- */
.form-group label,
.form-group .form-label {
    font-weight: 600; color: #333;
    font-size: 0.9rem; margin-bottom: 0.5rem;
}
.form-control {
    border-radius: 6px; padding: 0.6rem 1rem;
    height: auto; font-size: 0.95rem;
    border: 1px solid #ced4da;
}
.form-control:focus {
    border-color: #0A6C44;
    box-shadow: 0 0 0 0.2rem rgba(10, 108, 68, 0.25);
}

/* Horizontal form row for General Settings */
.form-row-label {
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
}
.form-row-desc {
    font-size: 0.85rem;
    color: #666;
    font-weight: 400;
    /* FIX: Added margin-top */
    margin-top: 0.35rem;
}

/* --- 9. Danger Zone (Right Column) --- */
#danger-zone {
    border: 1px solid #fde8e8;
    border-left: 4px solid #DC2626;
    box-shadow: none;
}
/* FIX: Override hover color for danger zone */
#danger-zone:hover {
    border-left-color: #DC2626;
}
#danger-zone .card-header { background-color: #fef2f2; }
#danger-zone .card-header h6 { color: #DC2626 !important; }

/* --- 10. Alert Messages --- */
.alert {
    border-radius: 6px; font-weight: 500; border: none;
    padding: 1rem 1.25rem;
}
.alert-success { background-color: #E6F4EA; color: #0A6C44; }
.alert-danger { background-color: #fef2f2; color: #DC2626; }
.alert-warning { background-color: #fffbeb; color: #B65900; }
.alert .close {
    font-size: 1.5rem; color: inherit; opacity: 0.7;
    text-shadow: none; font-weight: 700;
}
.alert .close:hover { opacity: 1; }

/* --- 11. FIX: Generic Form Styling --- */
/* This styles the form elements rendered by {{ field }} */
.card-body form .form-group label {
    font-weight: 600; 
    color: #333;
    font-size: 0.9rem; 
    margin-bottom: 0.5rem;
    display: block;
}

.card-body form .form-group input[type="text"],
.card-body form .form-group input[type="file"],
.card-body form .form-group input[type="number"],
.card-body form .form-group input[type="email"],
.card-body form .form-group input[type="password"],
.card-body form .form-group select,
.card-body form .form-group textarea {
    /* Apply the .form-control styles */
    display: block;
    width: 100%;
    box-sizing: border-box; /* Ensures padding doesn't break width */
    border-radius: 6px; 
    padding: 0.75rem 1rem; /* Match add_project.html */
    height: auto; 
    font-size: 0.95rem;
    border: 1px solid #8a8a8a; /* Match add_project.html */
    background: #f8f8f8; /* Match add_project.html */
    transition: all 0.2s ease;
    font-family: 'Inter', sans-serif;
}

.card-body form .form-group input[type="checkbox"] {
    width: 1.1rem;
    height: 1.1rem;
    margin-right: 0.5rem;
}

.card-body form .form-group select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    padding-right: 2rem;
    background-image: url("data:image/svg+xml;utf8,<svg width='16' height='11' viewBox='0 0 16 11' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M7.99976 7.19417L13.9025 1.29147C14.0125 1.17758 14.144 1.08674 14.2895 1.02424C14.435 0.961746 14.5915 0.92885 14.7498 0.927474C14.9082 0.926098 15.0652 0.95627 15.2117 1.01623C15.3583 1.07619 15.4914 1.16473 15.6034 1.27669C15.7153 1.38866 15.8039 1.5218 15.8638 1.66835C15.9238 1.8149 15.954 1.97192 15.9526 2.13026C15.9512 2.28859 15.9183 2.44506 15.8558 2.59055C15.7933 2.73604 15.7025 2.86762 15.5886 2.97762L8.84283 9.72339C8.61921 9.94694 8.31596 10.0725 7.99976 10.0725C7.68356 10.0725 7.38031 9.94694 7.15669 9.72339L0.41092 2.97762C0.297028 2.86762 0.206183 2.73604 0.143687 2.59055C0.0811915 2.44506 0.0482959 2.28859 0.04692 2.13026C0.0455441 1.97192 0.0757155 1.8149 0.135674 1.66835C0.195632 1.5218 0.284176 1.38866 0.39614 1.27669C0.508103 1.16473 0.641244 1.07619 0.787794 1.01623C0.934343 0.95627 1.09137 0.926098 1.2497 0.927474C1.40804 0.92885 1.56451 0.961746 1.71 1.02424C1.85548 1.08674 1.98706 1.17758 2.09706 1.29147L7.99976 7.19417Z' fill='%23374151'/></svg>");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 13px 8px;
}

.card-body form .form-group input[type="text"]:focus,
.card-body form .form-group input[type="file"]:focus,
.card-body form .form-group input[type="number"]:focus,
.card-body form .form-group input[type="email"]:focus,
.card-body form .form-group input[type="password"]:focus,
.card-body form .form-group select:focus,
.card-body form .form-group textarea:focus {
    outline: none;
    border-color: #0A6C44;
    box-shadow: 0 0 0 3px rgba(10, 108, 68, 0.2);
    background: #FFFFFF; 
}

.card-body form .form-text {
    /* Style help text */
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.35rem;
    display: block;
}

.card-body form .invalid-feedback {
    color: #DC2626;
    font-size: 0.85rem;
    margin-top: 0.35rem;
}

/* --- 12. FIX: API Key Warning Card --- */
#api-key-warning {
    border: 1px solid #fdf8e8;
    border-left: 4px solid #B65900; /* Orange/Amber */
    box-shadow: none;
}
#api-key-warning:hover {
    border-left-color: #B65900;
}
#api-key-warning .card-header { 
    background-color: #fffbeb; 
}
#api-key-warning .card-header h6 { 
    color: #B65900 !important; 
}

/* --- 13. FIX: API Key Input Group --- */
.api-key-group {
    display: flex;
    margin-top: 0.5rem;
}
.api-key-group input[type="text"] {
    /* Use the same form styles */
    flex-grow: 1;
    border-radius: 6px 0 0 6px; 
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    border: 1px solid #8a8a8a;
    background: #f8f8f8;
    font-family: 'Inter', sans-serif;
    border-right: none; /* Attach to button */
}
.api-key-group input[type="text"]:focus {
    outline: none;
    border-color: #0A6C44;
    box-shadow: 0 0 0 3px rgba(10, 108, 68, 0.2);
    background: #FFFFFF; 
    z-index: 2;
    position: relative;
}
.api-key-group .btn {
    border-radius: 0 6px 6px 0;
    z-index: 1;
    /* Manually align padding */
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
}
#copy-success {
    font-size: 0.85rem;
    margin-top: 0.5rem;
    display: block; /* Changed from inline */
}

</style>
<!-- END OF EMBEDDED STYLES -->


<!-- FIX: Changed container-fluid to main-container -->
<div class="main-container">
    <div class="row">
        <div class="col-lg-8">
            <!-- FIX: Added project-text title -->
            <h1 class="project-text">API Key Generated</h1>
            
            <!-- 
              FIX: Replaced old card classes with the new id="api-key-warning"
              to match the settings page style.
            -->
            <div class="card" id="api-key-warning">
                <div class="card-header">
                    <h6>API Key Generated Successfully</h6>
                </div>
                <div class="card-body">
                    <h4 style="color: #B65900;">Please copy your new API key now.</h4>
                    <p class="mb-4">
                        For your security, this is the <strong>only time</strong> you will be able to see the full key.
                        The system cannot retrieve it again.
                    </p>

                    <div class="form-group">
                        <label class="form-label">Key for: {{ api_key_name }}</label>
                        <!-- FIX: Replaced input-group with custom api-key-group -->
                        <div class="api-key-group">
                            <input type="text" value="{{ api_key_string }}" id="api-key-text" readonly>
                            <button class="btn btn-primary" type="button" id="copy-btn">
                                <i class="fas fa-copy fa-sm" style="margin-right: 0.5rem;"></i> Copy
                            </button>
                        </div>
                        <small id="copy-success" class="text-success" style="display: none;">Copied to clipboard!</small>
                    </div>

                    <hr>
                    <!-- FIX: Updated link to go back to main settings page -->
                    <a href="{% url 'system_settings:settings' %}" class="btn btn-secondary">
                        <i class="fas fa-check" style="margin-right: 0.5rem;"></i> I have copied the key
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('copy-btn').addEventListener('click', function() {
    var keyText = document.getElementById('api-key-text');
    keyText.select(); // Select the text
    
    try {
        // Use modern clipboard API
        navigator.clipboard.writeText(keyText.value).then(function() {
            // Success
            var successMsg = document.getElementById('copy-success');
            successMsg.style.display = 'block';
            document.getElementById('copy-btn').innerHTML = '<i class="fas fa-check fa-sm" style="margin-right: 0.5rem;"></i> Copied!';
            setTimeout(function() {
                successMsg.style.display = 'none';
                document.getElementById('copy-btn').innerHTML = '<i class="fas fa-copy fa-sm" style="margin-right: 0.5rem;"></i> Copy';
            }, 2000);
        }, function() {
            // Clipboard write failed, try fallback
            fallbackCopy(keyText);
        });
    } catch (err) {
        // Fallback for older browsers
        fallbackCopy(keyText);
    }
});

function fallbackCopy(keyText) {
    try {
        var successful = document.execCommand('copy');
        var successMsg = document.getElementById('copy-success');
        if (successful) {
            successMsg.style.display = 'block';
            document.getElementById('copy-btn').innerHTML = '<i class="fas fa-check fa-sm" style="margin-right: 0.5rem;"></i> Copied!';
        } else {
            successMsg.textContent = 'Failed to copy.';
            successMsg.style.color = '#DC2626';
            successMsg.style.display = 'block';
        }
        
        setTimeout(function() {
            successMsg.style.display = 'none';
            successMsg.textContent = 'Copied to clipboard!';
            successMsg.style.color = '#0A6C44';
            document.getElementById('copy-btn').innerHTML = '<i class="fas fa-copy fa-sm" style="margin-right: 0.5rem;"></i> Copy';
        }, 2000);
    } catch (err) {
        console.error('Fallback copy failed', err);
    }
}
</script>
{% endblock %}
