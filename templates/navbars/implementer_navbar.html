{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="{% static 'templates/top_style.css' %}" rel="stylesheet">
<link href="{% static 'templates/topbar.css' %}" rel="stylesheet">

</head>
<body>

	<div class="outside-container">
		<!-- Top Container -->
		<div class="top-container">
			<!-- Logo Container -->
			<div class="logo-container">
				<div class="logo-circle"></div>
				<div class="ueso-title">University Extensions<br>Services Office</div>
			</div>

			<!-- Button Container -->
			<div class="nav-center">
				<a href="{% url 'home' %}" class="nav-button {% if '/home/' in request.path %}active{% endif %}">Home</a>
				<a href="{% url 'downloadable_dispatcher' %}" class="nav-button {% if '/downloadables/' in request.path %}active{% endif %}">Downloadables</a>
				<a href="{% url 'announcement_dispatcher' %}" class="nav-button {% if '/announcements/' in request.path %}active{% endif %}">Announcements</a>
				<a href="/archives/" class="nav-button {% if '/archives/' in request.path %}active{% endif %}">Archives</a>
				<a href="{% url 'about_us_dispatcher' %}" class="nav-button {% if '/about-us/' in request.path %}active{% endif %}">About Us</a>
			</div>	 
			
			<!-- Profile Picture Modal -->
			<!-- Notifications Bell Icon -->
			<div class="topbar-icon-btn {% if '/notifications/' in request.path %}active{% endif %}" onclick="window.location.href='{% url 'notifications' %}'" title="Notifications">
				<svg width="24" height="30"><use href="#icon-topbar-notification"/></svg>
				{% if unread_notifications_count > 0 %}
				<span style="position:absolute;top:-5px;right:-5px;background:#FF3300;color:white;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:bold;border:2px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.2);">
					{{ unread_notifications_count }}
				</span>
				{% endif %}
			</div>
			
			<div class="logo-circle" id="profilePicContainer" style="position:relative;">
				<img src="{{ request.user.profile_picture_or_initial }}" alt="Profile Picture" class="logo-circle" id="profilePic" style="object-fit: cover; cursor:pointer;">
				
				<!-- Notification Badge on Profile Picture -->
				
				
				<div id="profileModal">
					<a href="{% url 'profile' %}">Profile</a>
					<a href="/settings/">Settings</a>
					<a href="{% url 'logout' %}" style="color:#E53E3E;">Log Out</a>
				</div>
			</div>
		</div>

		<!-- Bottom Container -->
		<div class="bottom-container">
			<a href="/projects/" class="bottom-nav-button {% if '/projects/' in request.path and '/expenses/' not in request.path and '/invoices/' not in request.path %}active{% endif %}">Projects</a>
			<a href="{% url 'calendar' %}" class="bottom-nav-button {% if '/calendar/' in request.path %}active{% endif %}">Calendar</a>
			<a href="/budget/" class="bottom-nav-button {% if '/budget/' in request.path or '/expenses/' in request.path or '/invoices/' in request.path %}active{% endif %}">Budget</a>
		</div>

	</div>

<script>
	document.addEventListener('DOMContentLoaded', function() {
		const profilePic = document.getElementById('profilePic');
		const profileModal = document.getElementById('profileModal');
		let modalOpen = false;
		if (profilePic && profileModal) {
			profilePic.addEventListener('click', function(e) {
				e.stopPropagation();
				profileModal.classList.toggle('show');
				modalOpen = profileModal.classList.contains('show');
			});
			document.addEventListener('mousedown', function(e) {
				if (profileModal.classList.contains('show') && !profileModal.contains(e.target) && e.target !== profilePic) {
					profileModal.classList.remove('show');
					modalOpen = false;
				}
			});
			profileModal.querySelectorAll('a').forEach(function(link) {
				link.addEventListener('click', function() {
					profileModal.classList.remove('show');
					modalOpen = false;
				});
			});
		}
	});
</script>

</body>

<button id="backToTopBtn"><i class="fa-solid fa-arrow-up"></i></button>

<script>
	// Window scroll persistence for director sidebar page
	document.addEventListener('DOMContentLoaded', function() {
		var scrollKey = 'windowScrollY_director';
		// Restore scroll after DOM is ready
		setTimeout(function() {
			var scrollY = sessionStorage.getItem(scrollKey);
			if (scrollY !== null) {
				window.scrollTo(0, parseInt(scrollY));
			}
		}, 0);

		// Save scroll on scroll event
		window.addEventListener('scroll', function() {
			sessionStorage.setItem(scrollKey, window.scrollY);
		});

		// Save scroll before navigation (for tab links in sidebar)
		var sidebarContainer = document.querySelector('.sidebar-container');
		if (sidebarContainer) {
			sidebarContainer.querySelectorAll('a').forEach(function(link) {
				link.addEventListener('mousedown', function() {
					sessionStorage.setItem(scrollKey, window.scrollY);
				});
				link.addEventListener('keydown', function(e) {
					if (e.key === 'Enter' || e.key === ' ') {
						sessionStorage.setItem(scrollKey, window.scrollY);
					}
				});
			});
		}
		
		var backToTopBtn = document.getElementById('backToTopBtn');

		function toggleBackToTop() {
			if (window.scrollY > 200) {
				backToTopBtn.classList.add('show');
			} else {
				backToTopBtn.classList.remove('show');
			}
		}

		window.addEventListener('scroll', toggleBackToTop);

		backToTopBtn.addEventListener('click', function() {
			window.scrollTo({ top: 0, behavior: 'smooth' });
		});
	});
</script>

<!-- SVG Sprite -->
<svg style="display:none;">
	<symbol id="icon-topbar-notification" viewBox="0 0 24 30" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M0.759766 25.3609V22.4809H3.63977V12.4009C3.63977 10.4089 4.23977 8.64486 5.43977 7.10886C6.63977 5.54886 8.19977 4.52886 10.1198 4.04886V3.04086C10.1198 2.44086 10.3238 1.93686 10.7318 1.52886C11.1638 1.09686 11.6798 0.880859 12.2798 0.880859C12.8798 0.880859 13.3838 1.09686 13.7918 1.52886C14.2238 1.93686 14.4398 2.44086 14.4398 3.04086V4.04886C16.3598 4.52886 17.9198 5.54886 19.1198 7.10886C20.3198 8.64486 20.9198 10.4089 20.9198 12.4009V22.4809H23.7998V25.3609H0.759766ZM12.2798 29.6809C11.4878 29.6809 10.8038 29.4049 10.2278 28.8529C9.67577 28.2769 9.39977 27.5929 9.39977 26.8009H15.1598C15.1598 27.5929 14.8718 28.2769 14.2958 28.8529C13.7438 29.4049 13.0718 29.6809 12.2798 29.6809ZM6.51977 22.4809H18.0398V12.4009C18.0398 10.8169 17.4758 9.46086 16.3478 8.33286C15.2198 7.20486 13.8638 6.64086 12.2798 6.64086C10.6958 6.64086 9.33977 7.20486 8.21177 8.33286C7.08377 9.46086 6.51977 10.8169 6.51977 12.4009V22.4809Z" fill="#1D1B20"/>
	</symbol>
</svg>


</html>
