{% extends "base_internal.html" %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Edit Submission</title>

<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
<link href="{% static 'shared/projects/styles.css' %}" rel="stylesheet">
<style>
    .readonly-field {
        background-color: #f3f4f6;
        cursor: not-allowed;
        opacity: 0.7;
    }
    .readonly-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 1rem;
        background: #f0f9ff;
        border-left: 4px solid #3b82f6;
        border-radius: 6px;
        margin-bottom: 1.5rem;
    }
    .readonly-info i {
        color: #3b82f6;
        font-size: 1.25rem;
    }
    .readonly-info p {
        margin: 0;
        color: #1e40af;
        font-size: 0.9rem;
    }
</style>
</head>
<body>
    <div class="main-container">
        <div class="user-details-title">
            <h2>Edit Submission Requirement</h2> 
            <p>Update deadline and notes for this submission requirement.</p>
        </div>

        <div class="readonly-info">
            <i class="fa-solid fa-info-circle"></i>
            <p><strong>Note:</strong> Project and Form fields are fixed and cannot be changed. Only deadline and notes can be edited.</p>
        </div>

        <form class="submission-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="user-details-section"> 
                <div class="user-details-category">  
                    <i class="fa-regular fa-address-card subtitle-icon"></i>
                    Details
                </div>
                
                <!-- Project Field (Read-only) -->
                <div class="form-group">
                    <label class="user-details-label" for="id_project">Project:</label>
                    <input type="text" class="user-details-value readonly-field" value="{{ submission.project.title }}" readonly disabled>
                    <small style="color:#666;font-size:0.875rem;margin-top:0.25rem;display:block;">
                        <i class="fa-solid fa-lock"></i> This field cannot be changed
                    </small>
                </div>

                <!-- Form Field (Read-only) -->
                <div class="form-group">
                    <label class="user-details-label">Form:</label>
                    <input type="text" class="user-details-value readonly-field" value="{{ submission.downloadable.name_with_ext }}" readonly disabled>
                    <small style="color:#666;font-size:0.875rem;margin-top:0.25rem;display:block;">
                        <i class="fa-solid fa-lock"></i> This field cannot be changed
                    </small>
                </div>

                <!-- Event Field (Read-only, only shown if submission has an event) -->
                {% if submission.event %}
                <div class="form-group">
                    <label class="user-details-label">Event:</label>
                    <input type="text" class="user-details-value readonly-field" value="{{ submission.event.title }} - {{ submission.event.start_datetime|date:'M d, Y g:i A' }}" readonly disabled>
                    <small style="color:#666;font-size:0.875rem;margin-top:0.25rem;display:block;">
                        <i class="fa-solid fa-lock"></i> This field cannot be changed
                    </small>
                </div>
                {% endif %}

                <!-- Deadline Field (Editable) -->
                <div class="form-group">
                    <label class="user-details-label" for="id_deadline">Deadline: <span class="required">*</span></label>
                    <input class="form-input user-details-value" type="datetime-local" name="deadline" id="id_deadline" value="{{ submission.deadline|date:'Y-m-d\TH:i' }}" required>
                    <small style="color:#666;font-size:0.875rem;margin-top:0.25rem;display:block;">
                        Set the new deadline for this submission requirement
                    </small>
                </div>

                <!-- Notes Field (Editable) -->
                <div class="form-group">
                    <label class="user-details-label" for="id_notes">Notes:</label>
                    <textarea class="form-input user-details-value" name="notes" id="id_notes" rows="4">{{ submission.notes|default:'' }}</textarea>
                    <small style="color:#666;font-size:0.875rem;margin-top:0.25rem;display:block;">
                        Add any additional instructions or information
                    </small>
                </div> 

                <div class="form-actions">
                    <a href="{% url 'submissions_admin' %}" class="back btn">Cancel</a>
                    <button type="submit" class="save btn">
                        <i class="fa-solid fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
        </form>
    </div>

<!-- SVG Sprite Section -->
<svg style="display:none;" xmlns="http://www.w3.org/2000/svg">
    <symbol id="icon-save" viewBox="0 0 16 16">
        <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
    </symbol>
</svg>

<script>
    // Form Validation for Required Fields
    document.querySelector('.submission-form').addEventListener('submit', function(e) {
        let valid = true;
        
        // Remove Previous Error States
        let deadlineError = document.getElementById('deadline-error');
        if (deadlineError) deadlineError.remove();
        
        // Validate Deadline
        const deadlineInput = document.getElementById('id_deadline');
        deadlineInput.classList.remove('error-input');
        if (!deadlineInput.value) {
            valid = false;
            deadlineInput.classList.add('error-input');
            const err = document.createElement('div');
            err.id = 'deadline-error';
            err.textContent = 'Deadline is required.';
            err.style.color = '#E53E3E';
            err.style.fontSize = '0.95rem';
            err.style.marginTop = '0.5rem';
            deadlineInput.parentNode.appendChild(err);
        }
        
        if (!valid) {
            e.preventDefault();
        }
    });
</script>

</body>
</html>

{% endblock %}
